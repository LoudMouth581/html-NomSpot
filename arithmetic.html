<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Arithmetic Quest</title>
<style>
  let totalQuestions = 0;
let totalTimeTaken = 0;
totalQuestions++;
totalTimeTaken += timeTaken;
totalQuestions++;

  body::before {
  content: "";
  position: fixed;
  top: 0;
  left: 60px;
  width: 2px;
  height: 100%;
  background-color: rgba(255, 0, 0, 0.3); /* red margin line */
  z-index: 0;
}
  body {
  margin: 0;
  padding: 0;
  background-color: #fff8dc;
  font-family: 'Courier New', Courier, monospace;
  color: #1a1a1a;
  display: flex;
  flex-direction: column;
  align-items: center;
  min-height: 100vh;
  user-select: none;

  background-image:
    linear-gradient(to bottom, rgba(0,0,0,0.05) 1px, transparent 1px),
    linear-gradient(to right, rgba(0,0,0,0.04) 1px, transparent 1px);
  background-size: 30px 30px;
}
  header {
    padding: 1rem 0;
    font-size: 2rem;
    font-weight: 700;
    text-align: center;
    color: #f0d600;
    text-shadow: 0 0 10px #f0d600;
  }
  #game-container {
  background: #ffffffcc;
  border: 2px solid #333;
  border-radius: 12px;
  padding: 30px;
  width: 90vw;
  max-width: 480px;
  box-shadow: 0 0 12px rgba(0, 0, 0, 0.25);
  display: flex;
  flex-direction: column;
  align-items: center;
  backdrop-filter: blur(2px);
}
  #mascot {
    width: 120px;
    height: 120px;
    margin-bottom: 10px;
    background: url('https://i.imgur.com/fGxAHgY.png') no-repeat center/contain;
    filter: drop-shadow(0 0 5px #f0d600);
  }
  #mascot-message {
    background: #0f2027cc;
    padding: 8px 15px;
    border-radius: 12px;
    min-height: 40px;
    font-weight: 600;
    margin-bottom: 20px;
    text-align: center;
  }
  #question {
    font-size: 1.8rem;
    font-weight: 700;
    margin-bottom: 15px;
    color: #f0d600;
    text-align: center;
  }
  #answers {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 15px;
    margin-bottom: 20px;
  }
  .answer-btn {
    background: #203a43;
    border-radius: 12px;
    padding: 15px 25px;
    font-size: 1.4rem;
    font-weight: 700;
    color: #eef9ff;
    box-shadow: 0 0 10px #f0d600bb;
    cursor: pointer;
    user-select: none;
    transition: transform 0.15s ease, background-color 0.3s ease;
    min-width: 80px;
    text-align: center;
  }
  .answer-btn:hover {
    background-color: #f0d600;
    color: #1e2a38;
    transform: scale(1.1);
  }
  #scoreboard {
    width: 100%;
    display: flex;
    justify-content: space-between;
    color: #f0d600;
    font-weight: 700;
    font-size: 1.2rem;
    margin-bottom: 15px;
  }
  #progress-bar {
    width: 100%;
    background: #203a43;
    border-radius: 15px;
    overflow: hidden;
    height: 18px;
    margin-bottom: 20px;
    box-shadow: inset 0 0 8px #f0d600aa;
  }
  #progress-fill {
    height: 100%;
    background: #f0d600;
    width: 0%;
    transition: width 0.3s ease;
  }
  #message {
    font-weight: 700;
    height: 24px;
    margin-bottom: 15px;
    min-height: 24px;
    text-align: center;
  }
  #powerups {
    display: flex;
    justify-content: center;
    gap: 20px;
    margin-bottom: 10px;
  }
  .powerup-btn {
    background: #203a43;
    border-radius: 12px;
    padding: 10px 18px;
    font-weight: 700;
    color: #eef9ff;
    cursor: pointer;
    box-shadow: 0 0 10px #f0d600bb;
    user-select: none;
    transition: background-color 0.3s ease;
  }
  .powerup-btn:disabled {
    opacity: 0.4;
    cursor: default;
  }
  .powerup-btn:hover:not(:disabled) {
    background-color: #f0d600;
    color: #1e2a38;
  }
  #level-display {
    font-weight: 700;
    font-size: 1.1rem;
    margin-bottom: 15px;
    text-align: center;
    color: #f0d600;
  }
  #unlockables {
    width: 100%;
    background: #1e2a38;
    border-radius: 15px;
    padding: 10px;
    box-shadow: inset 0 0 15px #f0d600aa;
    color: #f0d600cc;
    font-weight: 600;
    font-size: 1rem;
    max-height: 120px;
    overflow-y: auto;
  }
  /* Confetti CSS-only */
  .confetti-piece {
    position: fixed;
    width: 10px; height: 10px;
    background-color: #f0d600;
    opacity: 0.9;
    pointer-events: none;
    animation: confetti-fall 1.2s ease forwards;
    border-radius: 2px;
  }
  @keyframes confetti-fall {
    0% {transform: translateY(0) rotate(0deg);}
    100% {transform: translateY(100vh) rotate(360deg); opacity: 0;}
  }

  @media (max-width: 480px) {
    #game-container {
      width: 95vw;
      padding: 15px 20px;
    }
    #mascot {
      width: 90px;
      height: 90px;
    }
    .answer-btn {
      min-width: 70px;
      font-size: 1.2rem;
      padding: 12px 18px;
    }
  }
</style>
</head>
<body>
  
<header>Arithmetic Quest</header>

<div id="game-container" role="main" aria-live="polite">
  <div id="mascot" aria-label="Mascot"></div>
  <div id="mascot-message" aria-live="polite">Ready to master arithmetic? Let's start!</div>
  <div id="performance" style="text-align:center; margin-bottom: 15px;">
  Accuracy: <span id="accuracy">100%</span> | Avg Time: <span id="avgTime">0s</span>
</div>


  <div id="scoreboard">
    <div>Score: <span id="score">0</span></div>
    <div>Level: <span id="level">1</span></div>
    <div>Strikes: <span id="strikes">0</span>/3</div>
  </div>

  <div id="progress-bar" aria-label="Progress bar">
    <div id="progress-fill"></div>
  </div>

  <div id="question" aria-label="Math question" role="heading" aria-level="2">Loading question...</div>

  <div id="answers" role="list" aria-label="Answer choices"></div>

  <div id="message" aria-live="assertive"></div>

  <div id="powerups" aria-label="Power-ups">
    <button id="doublePointsBtn" class="powerup-btn" aria-pressed="false" title="Double your points on the next correct answer!">Double Points</button>
    <button id="skipBtn" class="powerup-btn" aria-pressed="false" title="Skip a question without penalty!">Skip Question</button>
  </div>

  <div id="unlockables" aria-live="polite" aria-label="Unlockable titles and badges">
    <strong>Unlockables:</strong>
    <ul id="unlockList"></ul>
  </div>
</div>

<script>
(() => {
  const scoreEl = document.getElementById('score');
  const levelEl = document.getElementById('level');
  const strikesEl = document.getElementById('strikes');
  const questionEl = document.getElementById('question');
  const answersEl = document.getElementById('answers');
  const messageEl = document.getElementById('message');
  const progressFill = document.getElementById('progress-fill');
  const mascotMessage = document.getElementById('mascot-message');
  const unlockList = document.getElementById('unlockList');

  const doublePointsBtn = document.getElementById('doublePointsBtn');
  const skipBtn = document.getElementById('skipBtn');

  const correctSound = new Audio('https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg');
  const wrongSound = new Audio('https://actions.google.com/sounds/v1/cartoon/cartoon_boing.ogg');
  const levelUpSound = new Audio('https://actions.google.com/sounds/v1/cartoon/slide_whistle_to_drum_hit.ogg');

  let score = 0;
  let level = 1;
  let strikes = 0;
  let streak = 0;
  let progress = 0;
  let doublePointsActive = false;
  let skipAvailable = 1;
  let totalQuestions = 0;
  let totalTimeTaken = 0;
  let questionStartTime = 0;
  let timerId;

  const unlockables = [
    { title: "Math Novice", threshold: 0, unlocked: false },
    { title: "Quick Thinker", threshold: 100, unlocked: false },
    { title: "Accuracy Ace", threshold: 250, unlocked: false },
    { title: "Speedster", threshold: 500, unlocked: false },
    { title: "Arithmetic Master", threshold: 1000, unlocked: false }
  ];

  const mascotsPhrases = {
    start: [
      "Ready to master arithmetic? Let's start!",
      "Math is fun! Let's do this!",
      "I believe in you! Show me what you've got!"
    ],
    correct: [
      "Great job!",
      "You nailed it!",
      "Awesome! Keep it up!",
      "You're on fire!"
    ],
    wrong: [
      "Oops, try again!",
      "Not quite, keep going!",
      "Don't give up!",
      "Almost there!"
    ],
    levelUp: [
      "Level up! You're getting better!",
      "Impressive! Next level unlocked!",
      "Keep up the great work!"
    ],
    streakBonus: [
      "Streak bonus! Keep rolling!",
      "Amazing accuracy!",
      "You're unstoppable!"
    ]
  };

  function speak(text) {
    if ('speechSynthesis' in window) {
      const utterance = new SpeechSynthesisUtterance(text);
      utterance.lang = 'en-US';
      speechSynthesis.cancel();
      speechSynthesis.speak(utterance);
    }
  }

  function randomInt(min, max) {
    return Math.floor(Math.random() * (max - min + 1)) + min;
  }

  function shuffleArray(arr) {
    for (let i = arr.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [arr[i], arr[j]] = [arr[j], arr[i]];
    }
  }

  function updateScoreboard() {
    scoreEl.textContent = score;
    levelEl.textContent = level;
    strikesEl.textContent = strikes;
    progressFill.style.width = progress + '%';

    doublePointsBtn.disabled = doublePointsActive;
    doublePointsBtn.setAttribute('aria-pressed', doublePointsActive.toString());
    skipBtn.disabled = skipAvailable < 1;

    updatePerformance(); // ← update performance here too
  }

  function updatePerformance() {
    const acc = totalQuestions ? ((score / (totalQuestions * 10)) * 100).toFixed(1) : 100;
    const avgTime = totalQuestions ? (totalTimeTaken / totalQuestions / 1000).toFixed(1) : 0;
    document.getElementById('accuracy').textContent = acc + '%';
    document.getElementById('avgTime').textContent = avgTime + 's';
  }

  function updateUnlockablesUI() {
    unlockList.innerHTML = '';
    unlockables.forEach(u => {
      const li = document.createElement('li');
      li.textContent = `${u.unlocked ? '🏅' : '🔒'} ${u.title}`;
      unlockList.appendChild(li);
    });
  }

  function getTimeLimitMs(level) {
    if (level <= 2) return 300000;
    if (level <= 4) return 120000;
    if (level <= 6) return 60000;
    if (level <= 8) return 45000;
    if (level <= 10) return 30000;
    return 20000;
  }

  function startTimer() {
    const timeLimit = getTimeLimitMs(level);
    questionStartTime = Date.now();
    timerId = setTimeout(() => {
      playWrong(); // fail if time expires
    }, timeLimit);
  }

  function stopTimer() {
    clearTimeout(timerId);
  }

  function generateQuestion() {
    messageEl.textContent = '';
    answersEl.innerHTML = '';

    const operations = ['+', '-', '*', '/'];
    const opIndex = Math.floor(Math.random() * Math.min(level, 4));
    const operation = operations[opIndex];

    let a, b, correctAnswer, expression, questionText;
    const max = 10 + level * 5;

    if (level < 4) {
      a = randomInt(1, max);
      b = randomInt(1, max);
    } else if (level < 7) {
      a = randomInt(10, max * 2);
      b = randomInt(5, max);
    } else {
      let c = randomInt(2, 10);
      a = randomInt(10, max);
      b = randomInt(10, max);
      expression = `(${a} ${operation} ${b}) * ${c}`;
      correctAnswer = eval(expression);
      questionText = `Solve: ${expression}`;
      questionEl.textContent = questionText;
      speak(questionText);
      setupMultipleChoice(correctAnswer);
      startTimer();
      return;
    }

    if (operation === '+') correctAnswer = a + b;
    else if (operation === '-') correctAnswer = a - b;
    else if (operation === '*') correctAnswer = a * b;
    else {
      b = b === 0 ? 1 : b;
      a = b * randomInt(1, max / b);
      correctAnswer = a / b;
    }

    const wordFormats = {
      '+': `If you have ${a} apples and get ${b} more, how many now?`,
      '-': `You had ${a} coins and spent ${b}. How many left?`,
      '*': `Each bag has ${a} marbles. How many in ${b} bags?`,
      '/': `Divide ${a} pencils equally into ${b} boxes. How many per box?`
    };

    questionText = wordFormats[operation];
    questionEl.textContent = questionText;
    speak(questionText);
    setupMultipleChoice(correctAnswer);
    startTimer();
  }

  function setupMultipleChoice(correctAnswer) {
    let choices = new Set();
    choices.add(correctAnswer);
    while (choices.size < 4) {
      let wrong = correctAnswer + randomInt(-10, 10);
      if (wrong !== correctAnswer && wrong >= 0) choices.add(wrong);
    }

    let choicesArr = Array.from(choices);
    shuffleArray(choicesArr);

    choicesArr.forEach(choice => {
      const btn = document.createElement('button');
      btn.className = 'answer-btn';
      btn.textContent = choice;
      btn.addEventListener('click', () => handleAnswer(choice, correctAnswer));
      answersEl.appendChild(btn);
    });
  }

  function handleAnswer(selected, correct) {
    stopTimer();
    if (selected === correct) {
      playCorrect();
    } else {
      playWrong();
    }
  }

  function playCorrect() {
    const timeTaken = Date.now() - questionStartTime;
    totalQuestions++;
    totalTimeTaken += timeTaken;

    streak++;
    strikes = 0;
    let basePoints = 10;
    if (timeTaken < 3000) basePoints += 5;
    if (doublePointsActive) basePoints *= 2;

    score += basePoints;
    progress += 20;
    correctSound.play();

    if (streak % 5 === 0) mascotMessage.textContent = mascotsPhrases.streakBonus[Math.floor(Math.random() * mascotsPhrases.streakBonus.length)];

    if (progress >= 100) {
      level++;
      progress = 0;
      mascotMessage.textContent = mascotsPhrases.levelUp[Math.floor(Math.random() * mascotsPhrases.levelUp.length)];
      levelUpSound.play();
    } else {
      mascotMessage.textContent = mascotsPhrases.correct[Math.floor(Math.random() * mascotsPhrases.correct.length)];
    }

    if (level >= 10) {
      mascotMessage.textContent = "🔥 Genius Level Activated! Answer fast!";
    }

    unlockables.forEach(u => {
      if (!u.unlocked && score >= u.threshold) u.unlocked = true;
    });

    updateScoreboard();
    updateUnlockablesUI();
    generateQuestion();
  }

  function playWrong() {
    totalQuestions++;
    streak = 0;
    strikes++;
    mascotMessage.textContent = mascotsPhrases.wrong[Math.floor(Math.random() * mascotsPhrases.wrong.length)];
    wrongSound.play();

    if (strikes >= 3) {
      alert('Game Over! Final Score: ' + score);
      resetGame();
    } else {
      updateScoreboard();
      generateQuestion();
    }
  }

  function resetGame() {
    score = 0;
    level = 1;
    strikes = 0;
    streak = 0;
    progress = 0;
    doublePointsActive = false;
    skipAvailable = 1;
    totalQuestions = 0;
    totalTimeTaken = 0;

    unlockables.forEach(u => u.unlocked = false);
    mascotMessage.textContent = mascotsPhrases.start[Math.floor(Math.random() * mascotsPhrases.start.length)];
    updateScoreboard();
    updateUnlockablesUI();
    generateQuestion();
  }

  doublePointsBtn.addEventListener('click', () => {
    if (!doublePointsActive) {
      doublePointsActive = true;
      doublePointsBtn.disabled = true;
      setTimeout(() => {
        doublePointsActive = false;
        doublePointsBtn.disabled = false;
        updateScoreboard();
      }, 10000);
      updateScoreboard();
    }
  });

  skipBtn.addEventListener('click', () => {
    if (skipAvailable > 0) {
      skipAvailable--;
      updateScoreboard();
      generateQuestion();
    }
  });

  // Initial game start
  mascotMessage.textContent = mascotsPhrases.start[Math.floor(Math.random() * mascotsPhrases.start.length)];
  updateScoreboard();
  updateUnlockablesUI();
  generateQuestion();
})();
</script>

</body>
</html>


