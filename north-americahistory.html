<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>50 States 3D Explorer — MiniMap</title>
    <style>
      :root {
        --bg1: #00111a;
        --bg2: #003147;
        --accent: #00d4ff;
        --accent2: #6df;
        --panel: rgba(255, 255, 255, 0.06);
        --glass: rgba(255, 255, 255, 0.07);
      }
      /* Page layout */
      * {
        box-sizing: border-box;
      }
      html,
      body {
        height: 100%;
        margin: 0;
        font-family: Inter, ui-sans-serif, system-ui, Segoe UI, Helvetica, Arial;
        background: linear-gradient(180deg, var(--bg1), var(--bg2));
        color: #eaf6ff;
      }
      header {
        position: fixed;
        left: 0;
        top: 8px;
        width: 100%;
        display: flex;
        justify-content: center;
        pointer-events: none;
      }
      h1 {
        margin: 0;
        padding: 8px 18px;
        background: linear-gradient(
          90deg,
          rgba(255, 255, 255, 0.06),
          rgba(255, 255, 255, 0.02)
        );
        border-radius: 10px;
        font-weight: 600;
        letter-spacing: 1px;
        pointer-events: auto;
      }
      /* Scene container */
      #scene-wrap {
        width: 100vw;
        height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 20px;
        padding: 48px;
      }
      #scene {
        width: 78vmin;
        height: 78vmin;
        perspective: 1300px;
        perspective-origin: 50% 40%;
        position: relative;
      }
      /* 3D board */
      #board {
        width: 100%;
        height: 100%;
        display: grid;
        grid-template-columns: repeat(8, 1fr);
        grid-template-rows: repeat(8, 1fr);
        transform-style: preserve-3d;
        transform: translate(-50%, -50%) rotateX(60deg) rotateY(0deg)
          translateZ(0px) scale(1);
        position: absolute;
        left: 50%;
        top: 50%;
        transition: transform 160ms linear;
        user-select: none;
        border-radius: 10px;
      }
      .tile {
        position: relative;
        margin: 0;
        padding: 6px;
        border: 1px solid rgba(255, 255, 255, 0.04);
        background: linear-gradient(
          180deg,
          rgba(255, 255, 255, 0.02),
          rgba(0, 0, 0, 0.12)
        );
        overflow: visible;
        transition: transform 220ms cubic-bezier(0.2, 0.9, 0.2, 1),
          box-shadow 220ms;
        transform-style: preserve-3d;
        display: flex;
        align-items: flex-end;
        justify-content: flex-start;
        font-size: 11px;
        color: #eaf6ff;
      }
      .tile:nth-child(odd) {
        background: linear-gradient(
          180deg,
          rgba(255, 255, 255, 0.01),
          rgba(0, 0, 0, 0.14)
        );
      }
      .tile .label {
        background: rgba(0, 0, 0, 0.35);
        padding: 6px 8px;
        border-radius: 8px;
        margin: 6px;
        backdrop-filter: blur(4px);
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.6);
        transform: translateZ(26px) scale(1);
      }
      .tile:hover {
        transform: translateZ(26px) scale(1.06);
        box-shadow: 0 10px 40px rgba(0, 200, 255, 0.08);
        cursor: pointer;
      }

      /* spawn effect (glow & particle) */
      .spawn {
        position: absolute;
        inset: 0;
        pointer-events: none;
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 2;
      }
      .spawn .glow {
        width: 62%;
        height: 62%;
        border-radius: 50%;
        background: radial-gradient(
          circle at 30% 30%,
          rgba(0, 212, 255, 0.45),
          rgba(0, 90, 180, 0.08) 45%,
          transparent 60%
        );
        filter: blur(8px);
        opacity: 0;
        transform: scale(0.6);
        animation: spawnPulse 2.6s infinite ease-in-out;
      }
      .spawn .orb {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        background: linear-gradient(180deg, var(--accent), var(--accent2));
        box-shadow: 0 0 10px rgba(0, 212, 255, 0.8);
        transform: translateY(6px);
        animation: orbFloat 1.6s infinite ease-in-out;
        opacity: 0;
        animation-delay: 0.2s;
        animation-fill-mode: both;
      }

      @keyframes spawnPulse {
        0% {
          opacity: 0;
          transform: scale(0.6);
        }
        30% {
          opacity: 0.85;
          transform: scale(1);
        }
        70% {
          opacity: 0.35;
          transform: scale(1.12);
        }
        100% {
          opacity: 0;
          transform: scale(1.3);
        }
      }
      @keyframes orbFloat {
        0% {
          opacity: 0;
          transform: translateY(8px) scale(0.9);
        }
        10% {
          opacity: 1;
        }
        50% {
          transform: translateY(-8px) scale(1.05);
        }
        100% {
          transform: translateY(8px) scale(0.95);
        }
      }

      /* mini-map */
      #side {
        width: 300px;
        max-width: 30vmin;
        display: flex;
        flex-direction: column;
        gap: 12px;
        align-items: center;
        pointer-events: auto;
      }
      .panel {
        width: 100%;
        background: var(--panel);
        border-radius: 12px;
        padding: 12px;
        backdrop-filter: blur(6px);
        box-shadow: 0 6px 30px rgba(0, 0, 0, 0.5);
      }
      .minimap {
        width: 100%;
        aspect-ratio: 1.1;
        display: grid;
        grid-template-columns: repeat(8, 1fr);
        grid-template-rows: repeat(8, 1fr);
        gap: 2px;
        background: linear-gradient(
          180deg,
          rgba(255, 255, 255, 0.02),
          rgba(0, 0, 0, 0.12)
        );
        padding: 6px;
        border-radius: 8px;
      }
      .mini-cell {
        background: rgba(255, 255, 255, 0.03);
        border-radius: 4px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 9px;
        color: rgba(255, 255, 255, 0.7);
      }
      .mini-selected {
        outline: 2px solid rgba(0, 212, 255, 0.6);
        box-shadow: 0 2px 10px rgba(0, 212, 255, 0.06);
      }

      /* info panel and modal */
      .info-title {
        font-weight: 600;
        margin: 0 0 6px 0;
      }
      .info-row {
        display: flex;
        gap: 8px;
        align-items: center;
        font-size: 13px;
      }
      .btn {
        display: inline-flex;
        gap: 8px;
        align-items: center;
        padding: 8px 10px;
        border-radius: 8px;
        background: linear-gradient(
          180deg,
          rgba(255, 255, 255, 0.02),
          rgba(255, 255, 255, 0.01)
        );
        border: 1px solid rgba(255, 255, 255, 0.04);
        cursor: pointer;
      }
      .hint {
        font-size: 12px;
        color: rgba(255, 255, 255, 0.65);
      }
      /* modal */
      .modal {
        position: fixed;
        left: 50%;
        top: 50%;
        transform: translate(-50%, -50%) scale(0.98);
        min-width: 320px;
        max-width: 92vw;
        background: linear-gradient(
          180deg,
          rgba(6, 18, 28, 0.95),
          rgba(3, 9, 16, 0.96)
        );
        border-radius: 12px;
        padding: 18px;
        border: 1px solid rgba(255, 255, 255, 0.04);
        box-shadow: 0 30px 80px rgba(0, 0, 0, 0.6);
        z-index: 999;
        display: none;
      }
      .modal.show {
        display: block;
        animation: modalIn 0.18s ease-out both;
      }
      @keyframes modalIn {
        from {
          opacity: 0;
          transform: translate(-50%, -50%) scale(0.96);
        }
        to {
          opacity: 1;
          transform: translate(-50%, -50%) scale(1);
        }
      }
      .modal h3 {
        margin: 0 0 6px 0;
      }
      .modal .row {
        display: flex;
        gap: 10px;
        align-items: center;
      }

      /* tiny legend */
      .legend {
        display: flex;
        gap: 8px;
        align-items: center;
        font-size: 12px;
        color: rgba(255, 255, 255, 0.8);
      }
      .dot {
        width: 12px;
        height: 12px;
        border-radius: 50%;
      }
      .dot.spawn {
        background: linear-gradient(180deg, #00d4ff, #0066ff);
      }
      .dot.stable {
        background: linear-gradient(180deg, #cde6e9, #7fb8c5);
      }
      /* responsiveness */
      @media (max-width: 900px) {
        #scene-wrap {
          flex-direction: column;
          padding: 12px;
        }
        #side {
          width: 94vw;
          max-width: none;
        }
        #scene {
          width: 92vmin;
          height: 56vmin;
        }
      }
    </style>
  </head>
  <body>
    <header><h1>50 States 3D Explorer — Mini-Map</h1></header>

    <div id="scene-wrap">
      <div id="scene">
        <div id="board" title="Drag to rotate, wheel to zoom"></div>
      </div>

      <div id="side">
        <div class="panel">
          <div class="info-title">Selected State</div>
          <div id="selectedCard" style="min-height: 64px">
            <div class="hint">Hover or click a tile to inspect it.</div>
          </div>
          <div
            style="
              display: flex;
              justify-content: space-between;
              align-items: center;
              margin-top: 8px;
            "
          >
            <div class="legend">
              <div class="dot spawn"></div>
              <div>Spawn</div>
              <div style="width: 18px"></div>
              <div class="dot stable"></div>
              <div>Stable</div>
            </div>
            <div class="hint">Tip: Drag board & wheel to zoom</div>
          </div>
        </div>

        <div class="panel">
          <div class="info-title" style="margin-bottom: 8px">
            Mini-Map (8×8)
          </div>
          <div id="mini" class="minimap"></div>
        </div>

        <div class="panel">
          <div class="info-title">Controls</div>
          <div class="info-row" style="margin-top: 8px">
            <div class="btn" id="centerBtn">Center View</div>
            <div class="btn" id="spawnToggle">Toggle Spawns</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal -->
    <div id="modal" class="modal" role="dialog" aria-modal="true">
      <button id="closeModal" class="btn" style="float: right">Close</button>
      <h3 id="modalTitle"></h3>
      <div id="modalBody"></div>
    </div>

    <script>
      /*
  50 States data: name, abbreviation, capital
  (Simple factual info — capitals are stable; used here to populate the modal. All original text.)
*/
      const states = [
        { name: "Alabama", abbr: "AL", capital: "Montgomery" },
        { name: "Alaska", abbr: "AK", capital: "Juneau" },
        { name: "Arizona", abbr: "AZ", capital: "Phoenix" },
        { name: "Arkansas", abbr: "AR", capital: "Little Rock" },
        { name: "California", abbr: "CA", capital: "Sacramento" },
        { name: "Colorado", abbr: "CO", capital: "Denver" },
        { name: "Connecticut", abbr: "CT", capital: "Hartford" },
        { name: "Delaware", abbr: "DE", capital: "Dover" },
        { name: "Florida", abbr: "FL", capital: "Tallahassee" },
        { name: "Georgia", abbr: "GA", capital: "Atlanta" },
        { name: "Hawaii", abbr: "HI", capital: "Honolulu" },
        { name: "Idaho", abbr: "ID", capital: "Boise" },
        { name: "Illinois", abbr: "IL", capital: "Springfield" },
        { name: "Indiana", abbr: "IN", capital: "Indianapolis" },
        { name: "Iowa", abbr: "IA", capital: "Des Moines" },
        { name: "Kansas", abbr: "KS", capital: "Topeka" },
        { name: "Kentucky", abbr: "KY", capital: "Frankfort" },
        { name: "Louisiana", abbr: "LA", capital: "Baton Rouge" },
        { name: "Maine", abbr: "ME", capital: "Augusta" },
        { name: "Maryland", abbr: "MD", capital: "Annapolis" },
        { name: "Massachusetts", abbr: "MA", capital: "Boston" },
        { name: "Michigan", abbr: "MI", capital: "Lansing" },
        { name: "Minnesota", abbr: "MN", capital: "Saint Paul" },
        { name: "Mississippi", abbr: "MS", capital: "Jackson" },
        { name: "Missouri", abbr: "MO", capital: "Jefferson City" },
        { name: "Montana", abbr: "MT", capital: "Helena" },
        { name: "Nebraska", abbr: "NE", capital: "Lincoln" },
        { name: "Nevada", abbr: "NV", capital: "Carson City" },
        { name: "New Hampshire", abbr: "NH", capital: "Concord" },
        { name: "New Jersey", abbr: "NJ", capital: "Trenton" },
        { name: "New Mexico", abbr: "NM", capital: "Santa Fe" },
        { name: "New York", abbr: "NY", capital: "Albany" },
        { name: "North Carolina", abbr: "NC", capital: "Raleigh" },
        { name: "North Dakota", abbr: "ND", capital: "Bismarck" },
        { name: "Ohio", abbr: "OH", capital: "Columbus" },
        { name: "Oklahoma", abbr: "OK", capital: "Oklahoma City" },
        { name: "Oregon", abbr: "OR", capital: "Salem" },
        { name: "Pennsylvania", abbr: "PA", capital: "Harrisburg" },
        { name: "Rhode Island", abbr: "RI", capital: "Providence" },
        { name: "South Carolina", abbr: "SC", capital: "Columbia" },
        { name: "South Dakota", abbr: "SD", capital: "Pierre" },
        { name: "Tennessee", abbr: "TN", capital: "Nashville" },
        { name: "Texas", abbr: "TX", capital: "Austin" },
        { name: "Utah", abbr: "UT", capital: "Salt Lake City" },
        { name: "Vermont", abbr: "VT", capital: "Montpelier" },
        { name: "Virginia", abbr: "VA", capital: "Richmond" },
        { name: "Washington", abbr: "WA", capital: "Olympia" },
        { name: "West Virginia", abbr: "WV", capital: "Charleston" },
        { name: "Wisconsin", abbr: "WI", capital: "Madison" },
        { name: "Wyoming", abbr: "WY", capital: "Cheyenne" },
      ];

      // Basic board geometry
      const rows = 8,
        cols = 8;
      const boardEl = document.getElementById("board");
      const mini = document.getElementById("mini");
      const card = document.getElementById("selectedCard");
      const modal = document.getElementById("modal");
      const modalTitle = document.getElementById("modalTitle");
      const modalBody = document.getElementById("modalBody");
      const closeModal = document.getElementById("closeModal");

      // camera state
      let rotX = 60,
        rotY = 0,
        zoom = 1;
      let dragging = false,
        lastX = 0,
        lastY = 0;

      // spawn system
      let spawnActive = true;
      const spawnRateMs = 1800; // attempt spawn every interval
      const activeSpawns = new Map(); // key: idx, value: spawnExpireTime

      // utility math
      function totalSquares(n) {
        return (n * (n + 1) * (2 * n + 1)) / 6;
      } // 204 for 8
      function totalRectangles(n) {
        return ((n * (n + 1)) / 2) ** 2;
      } // 1296 for 8

      console.log("total squares (all sizes):", totalSquares(rows));
      console.log("total rectangles (all sizes):", totalRectangles(rows));

      // Build board and minimap
      let globalIndex = 0;
      for (let y = 0; y < rows; y++) {
        for (let x = 0; x < cols; x++) {
          const idx = globalIndex;
          const state = states[idx % states.length]; // cycle through 50
          const t = document.createElement("div");
          t.className = "tile";
          t.dataset.idx = idx;
          t.dataset.x = x + 1;
          t.dataset.y = y + 1;
          t.dataset.state = state.name;

          // Compute a z-height for 3D effect (based on trig like you specified)
          const z = Math.sin((x + 1) * 0.9) * Math.cos((y + 1) * 0.9) * 12;
          t.style.transform = `translateZ(${z}px)`;

          // label box (state abbrev)
          const label = document.createElement("div");
          label.className = "label";
          label.innerHTML = `<strong>${state.abbr}</strong> &nbsp;<span style="opacity:.9;font-size:11px">${state.name}</span>`;
          t.appendChild(label);

          // spawn container placeholder
          const spawnWrap = document.createElement("div");
          spawnWrap.className = "spawn";
          spawnWrap.innerHTML = `<div class="glow"></div><div class="orb"></div>`;
          spawnWrap.style.opacity = 0;
          t.appendChild(spawnWrap);

          // event listeners
          t.addEventListener("mouseenter", () => {
            showSelected(state, x + 1, y + 1, z.toFixed(2), idx);
            // quick hint: highlight minimap cell
            highlightMini(idx);
          });
          t.addEventListener("click", () => {
            openModal(state, x + 1, y + 1, z.toFixed(2), idx);
          });

          boardEl.appendChild(t);

          // minimap cell
          const miniCell = document.createElement("div");
          miniCell.className = "mini-cell";
          miniCell.dataset.idx = idx;
          miniCell.textContent = state.abbr;
          mini.appendChild(miniCell);

          globalIndex++;
        }
      }

      // show selected info
      function showSelected(state, x, y, z, idx) {
        card.innerHTML = `
    <div style="display:flex;justify-content:space-between;align-items:center">
      <div>
        <div style="font-weight:700">${state.name} <span style="opacity:.7">(${state.abbr})</span></div>
        <div style="font-size:13px;color:rgba(255,255,255,0.75)">Capital: ${state.capital}</div>
        <div style="font-size:12px;color:rgba(255,255,255,0.6);margin-top:6px">X:${x} Y:${y} Z:${z}</div>
      </div>
      <div style="display:flex;flex-direction:column;gap:8px">
        <button class="btn" onclick="openModalFromCard(${idx})">Details</button>
      </div>
    </div>
  `;
      }

      // modal open
      function openModalFromCard(idx) {
        const tile = document.querySelector(`.tile[data-idx='${idx}']`);
        if (!tile) return;
        const abbr = tile.dataset.state;
        const state = states[idx % states.length];
        openModal(
          state,
          tile.dataset.x,
          tile.dataset.y,
          tile.style.transform.replace(/[^\d\.\-]/g, ""),
          idx
        );
      }

      function openModal(state, x, y, z, idx) {
        modalTitle.textContent = `${state.name} — ${state.abbr}`;
        modalBody.innerHTML = `
    <div class="row" style="margin-top:8px">
      <div style="flex:1">
        <div><strong>Capital:</strong> ${state.capital}</div>
        <div style="margin-top:6px;color:rgba(255,255,255,0.75)"><strong>Grid:</strong> X:${x} Y:${y}</div>
        <div style="margin-top:8px;font-size:13px">This panel is intentionally minimal and original — add your own notes, images, or links here as you like.</div>
      </div>
    </div>
    <div style="margin-top:12px;display:flex;gap:8px">
      <button class="btn" onclick="centerOn(${idx})">Center on tile</button>
      <button class="btn" id="closeFromModal" onclick="closeModalFn()">Close</button>
    </div>
  `;
        modal.classList.add("show");
      }
      closeModal.addEventListener("click", closeModalFn);
      function closeModalFn() {
        modal.classList.remove("show");
      }

      // center camera on tile
      function centerOn(idx) {
        // idx -> x,y
        const x = idx % cols;
        const y = Math.floor(idx / cols);
        // map grid to rotation values: center means rotX ~ 66, rotY ~ -((x-3.5)*10)
        rotX = 62;
        rotY = -((x - (cols - 1) / 2) * 8) - (y - (rows - 1) / 2) * 3;
        updateBoardTransform();
        highlightMini(idx);
        modal.classList.remove("show");
      }

      // minimap highlight
      function highlightMini(idx) {
        document
          .querySelectorAll(".mini-cell")
          .forEach((c) => c.classList.remove("mini-selected"));
        const el = document.querySelector(`.mini-cell[data-idx='${idx}']`);
        if (el) el.classList.add("mini-selected");
      }

      // camera controls (drag to rotate)
      const board = document.getElementById("board");
      board.addEventListener("mousedown", (ev) => {
        dragging = true;
        lastX = ev.clientX;
        lastY = ev.clientY;
        ev.preventDefault();
      });
      window.addEventListener("mousemove", (ev) => {
        if (!dragging) return;
        const dx = ev.clientX - lastX;
        const dy = ev.clientY - lastY;
        rotY += dx * 0.25;
        rotX -= dy * 0.18;
        rotX = Math.min(Math.max(rotX, 18), 85);
        lastX = ev.clientX;
        lastY = ev.clientY;
        updateBoardTransform();
      });
      window.addEventListener("mouseup", () => (dragging = false));
      window.addEventListener("mouseleave", () => (dragging = false));

      // touch handlers (mobile)
      let touchLastX = 0,
        touchLastY = 0;
      board.addEventListener("touchstart", (e) => {
        if (e.touches.length === 1) {
          touchLastX = e.touches[0].clientX;
          touchLastY = e.touches[0].clientY;
          dragging = true;
        }
      });
      board.addEventListener("touchmove", (e) => {
        if (!dragging || e.touches.length !== 1) return;
        const dx = e.touches[0].clientX - touchLastX;
        const dy = e.touches[0].clientY - touchLastY;
        rotY += dx * 0.25;
        rotX -= dy * 0.18;
        rotX = Math.min(Math.max(rotX, 18), 85);
        touchLastX = e.touches[0].clientX;
        touchLastY = e.touches[0].clientY;
        updateBoardTransform();
      });
      board.addEventListener("touchend", () => (dragging = false));

      // zoom
      window.addEventListener(
        "wheel",
        (e) => {
          zoom += e.deltaY * -0.0012;
          zoom = Math.min(Math.max(zoom, 0.5), 1.8);
          updateBoardTransform();
          e.preventDefault();
        },
        { passive: false }
      );

      function updateBoardTransform() {
        board.style.transform = `translate(-50%,-50%) rotateX(${rotX}deg) rotateY(${rotY}deg) scale(${zoom})`;
      }

      // center button
      document.getElementById("centerBtn").addEventListener("click", () => {
        rotX = 60;
        rotY = 0;
        zoom = 1.02;
        updateBoardTransform();
      });

      // spawn toggle
      document.getElementById("spawnToggle").addEventListener("click", () => {
        spawnActive = !spawnActive;
        document.getElementById("spawnToggle").textContent = spawnActive
          ? "Toggle Spawns"
          : "Spawns: Off";
      });

      // spawn logic: pick random tiles and animate spawn, avoid too many
      const maxConcurrentSpawns = 8;
      function doSpawnTick() {
        if (!spawnActive) {
          // clear spawns
          activeSpawns.clear();
          document
            .querySelectorAll(".tile .spawn")
            .forEach((s) => (s.style.opacity = 0));
          return;
        }
        const timeNow = performance.now();
        // remove expired spawns
        for (const [k, expire] of activeSpawns.entries()) {
          if (timeNow > expire) {
            activeSpawns.delete(k);
            const el = document.querySelector(`.tile[data-idx='${k}'] .spawn`);
            if (el) el.style.opacity = 0;
          }
        }

        // spawn chance: prefer higher anomaly tiles based on trig function to make "zones"
        // compute anomaly scores for each tile and pick a candidate weighted
        const scores = [];
        for (let i = 0; i < rows * cols; i++) {
          if (activeSpawns.has(i)) continue;
          const x = (i % cols) + 1;
          const y = Math.floor(i / cols) + 1;
          // anomaly computed as abs(sin(x*y))*100 as earlier
          const anomaly = Math.abs(Math.sin(x * y)) * 100;
          // weight moderately by anomaly and random
          const weight = anomaly * (0.6 + Math.random() * 1.2);
          scores.push({ i, weight });
        }
        // sort descending and possibly spawn up to fill capacity
        scores.sort((a, b) => b.weight - a.weight);

        let slots = maxConcurrentSpawns - activeSpawns.size;
        while (slots > 0 && scores.length > 0 && Math.random() < 0.7) {
          const cand = scores.shift();
          if (!cand) break;
          const idx = cand.i;
          const tileSpawn = document.querySelector(
            `.tile[data-idx='${idx}'] .spawn`
          );
          if (!tileSpawn) continue;
          // show spawn
          tileSpawn.style.opacity = 1;
          // schedule expire (6s - 12s)
          const expire = timeNow + (6000 + Math.floor(Math.random() * 7000));
          activeSpawns.set(idx, expire);
          slots--;
        }
      }

      // ticking loop
      setInterval(doSpawnTick, spawnRateMs);

      // small animation to slowly rotate board for idle (if not dragging)
      let idleCounter = 0;
      setInterval(() => {
        if (!dragging) {
          rotY += 0.06 * Math.sin(performance.now() / 4000);
          updateBoardTransform();
        }
      }, 40);

      // mini map cell click to center
      mini.addEventListener("click", (e) => {
        const c = e.target.closest(".mini-cell");
        if (!c) return;
        const idx = Number(c.dataset.idx);
        centerOn(idx);
      });

      // initial transforms & highlight first
      updateBoardTransform();
      highlightMini(0);

      // keyboard shortcuts for accessibility
      window.addEventListener("keydown", (e) => {
        if (e.key === "Escape") closeModalFn();
      });

      // accessibility: close modal on outside click
      window.addEventListener("click", (ev) => {
        if (
          modal.classList.contains("show") &&
          !modal.contains(ev.target) &&
          !ev.target.closest(".btn")
        ) {
          closeModalFn();
        }
      });

      // Expose a couple of functions for inline handlers
      window.openModalFromCard = openModalFromCard;
      window.closeModalFn = closeModalFn;
      window.centerOn = centerOn;
    </script>

    <a href="../profile.html">Back to Profiles</a>
  </body>
</html>
