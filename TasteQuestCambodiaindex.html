<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Taste Quest: Cambodia</title>
    <link rel="stylesheet" href="../CSS/TasteQuestCambodiastyles.css" />
  </head>
  <style>/* Global look */
body {
  margin: 0;
  background: radial-gradient(circle at top, #0b0f2a, #010314 80%);
  color: #e3e3e3;
  font-family: "Orbitron", "Poppins", sans-serif;
}

h1,
h2,
h3 {
  text-shadow: 0 0 8px #00f9ff;
}

header.header-future {
  background: linear-gradient(90deg, #020024, #090979, #00d4ff);
  padding: 1rem 2rem;
  display: flex;
  justify-content: space-between;
  align-items: center;
  box-shadow: 0 0 15px rgba(0, 255, 255, 0.3);
}

.nav-btn {
  color: #fff;
  background: #00e0ff;
  border: none;
  padding: 0.7rem 1.2rem;
  border-radius: 10px;
  text-decoration: none;
  font-weight: 700;
  transition: all 0.3s ease;
}
.nav-btn:hover {
  background: #05f5a5;
  box-shadow: 0 0 10px #00f9ff;
}

/* Map & dropdown area */
.map-section {
  text-align: center;
  margin: 3rem auto;
  max-width: 600px;
}
#province-select {
  padding: 0.6rem;
  border-radius: 8px;
  background: #14182f;
  color: #00f9ff;
  border: 2px solid #00f9ff;
  font-family: inherit;
  font-size: 1rem;
}
.info-box {
  background: rgba(0, 255, 255, 0.05);
  border: 1px solid #00f9ff;
  border-radius: 10px;
  margin-top: 1rem;
  padding: 1rem;
  box-shadow: 0 0 10px #00f9ff33;
}

/* Battle section */
.battle-section {
  text-align: center;
  margin-top: 4rem;
}
.battle-btn {
  background: linear-gradient(45deg, #ff006e, #ffbe0b);
  border: none;
  color: white;
  padding: 1rem 2rem;
  border-radius: 50px;
  font-size: 1.1rem;
  font-weight: bold;
  transition: 0.3s;
  cursor: pointer;
}
.battle-btn:hover {
  transform: scale(1.05);
  box-shadow: 0 0 15px #ffbe0b;
}
.battle-box {
  margin-top: 1.5rem;
  min-height: 50px;
  font-size: 1.1rem;
}

/* Calendar */
.calendar-section table {
  margin: 2rem auto;
  width: 90%;
  border-collapse: collapse;
  background: rgba(255, 255, 255, 0.05);
  border-radius: 10px;
  overflow: hidden;
}
.calendar-section th,
.calendar-section td {
  padding: 0.8rem;
  border: 1px solid #00f9ff55;
}
.calendar-section th {
  background: #00f9ff33;
}

/* Partner Page */
.partner-container {
  display: flex;
  justify-content: center;
  margin-top: 3rem;
}
.partner-box {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid #00f9ff44;
  border-radius: 12px;
  padding: 2rem;
  width: 80%;
  max-width: 600px;
  text-align: center;
  box-shadow: 0 0 20px #00f9ff22;
}
.partner-btn {
  margin: 0.5rem;
  padding: 0.8rem 1.2rem;
  border-radius: 10px;
  font-weight: bold;
  border: none;
  cursor: pointer;
  transition: 0.3s;
}
.partner-btn.vlog {
  background: linear-gradient(45deg, #ff00cc, #3333ff);
}
.partner-btn.indie {
  background: linear-gradient(45deg, #05f5a5, #00bcd4);
}
.partner-btn.sponsor {
  background: linear-gradient(45deg, #ffd600, #ff8c00);
}
.partner-btn.cafe {
  background: linear-gradient(45deg, #7b2ff7, #f107a3);
}
.partner-btn:hover {
  transform: scale(1.05);
  box-shadow: 0 0 10px #00f9ff;
}

.submit-btn {
  background: linear-gradient(45deg, #00f9ff, #00e0ff);
  color: #000;
  font-weight: 700;
  border: none;
  padding: 0.8rem 1.5rem;
  border-radius: 8px;
  margin-top: 1rem;
  cursor: pointer;
}
.submit-btn:hover {
  background: #05f5a5;
}
/* Append to style.css */

/* Food Pyramid Cards */
.food-card {
  background: #fff8e1;
  border-radius: 10px;
  padding: 1rem;
  margin: 0.5rem;
  text-align: center;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
  transition: transform 0.2s;
}

.food-card:hover {
  transform: scale(1.05);
}

.battle-container {
  text-align: center;
  padding: 1.5rem;
}

.battle-btn {
  background: #4caf50;
  border: none;
  color: white;
  padding: 0.8rem 1.2rem;
  border-radius: 10px;
  font-size: 1.2rem;
  cursor: pointer;
  transition: 0.3s;
}

.battle-btn:hover {
  background: #45a049;
}
/* AR Event Pop-up */
.ar-event {
  position: fixed;
  bottom: 10%;
  left: 50%;
  transform: translateX(-50%);
  background: rgba(255, 255, 255, 0.95);
  border-radius: 12px;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
  padding: 1rem 1.5rem;
  text-align: center;
  width: 90%;
  max-width: 400px;
  z-index: 1000;
  animation: fadeIn 0.4s ease-out;
}

@keyframes fadeIn {
  from {
    opacity: 0;
    transform: translateX(-50%) translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateX(-50%) translateY(0);
  }
}

.ar-event h2 {
  margin-top: 0;
}

.ar-event button {
  background: #00796b;
  color: white;
  border: none;
  border-radius: 10px;
  padding: 0.6rem 1rem;
  margin-top: 0.5rem;
  cursor: pointer;
}
</style>
  <body>
    <header class="header-future">
      <h1>üçú Taste Quest: Cambodia</h1>
      <nav>
        <a href="./TasteQuestCambodiabusiness.html" class="nav-btn"
          >Partner Portal</a
        >
      </nav>
        <nav>
            <a href="NomNomindex.html" class="nav-btn"
              >NomNom</a
            >
          </nav>
    </header>

    <main>
      <!-- MAP DROPDOWN -->
      <section class="map-section">
        <h2>Explore Cambodia</h2>
        <p>Select a province or area to begin your SpiceCore adventure:</p>
        <select id="province-select">
          <option value="">-- Choose a Region (25 Areas) --</option>
        </select>

        <div id="province-info" class="info-box">
          <h3 id="selected-province">No Region Selected</h3>
          <p id="province-details">
            Pick a region to view its food quest and battle opportunities.
          </p>
        </div>
      </section>

      <!-- BATTLE / CHEF CHALLENGE -->
      <section class="battle-section">
        <h2>üî• Chef Showdown Arena</h2>
        <p>Challenge top chefs or friends to duels and quests ‚Äî earn badges!</p>
        <button id="start-battle" class="battle-btn">Start Battle</button>
        <div id="battle-result" class="battle-box"></div>
      </section>

      <!-- HOLIDAY CALENDAR -->
      <section class="calendar-section">
        <h2>üéâ Cambodian Holiday Calendar</h2>
        <p>Events and challenges.</p>

        <table id="holiday-calendar">
          <thead>
            <tr>
              <th>Holiday</th>
              <th>Date</th>
              <th>Description</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Khmer New Year</td>
              <td>April 13‚Äì16</td>
              <td>Biggest festival with cooking contests & family feasts.</td>
            </tr>
            <tr>
              <td>Pchum Ben</td>
              <td>October (15th day of waning moon)</td>
              <td>Offerings and special dessert quests.</td>
            </tr>
            <tr>
              <td>Water Festival (Bon Om Touk)</td>
              <td>November</td>
              <td>Boat races, river foods, and seafood events.</td>
            </tr>
            <tr>
              <td>Royal Plowing Ceremony</td>
              <td>May</td>
              <td>Start of rice season; farming and harvest-themed quests.</td>
            </tr>
            <tr>
              <td>Independence Day</td>
              <td>November 9</td>
              <td>Special ‚ÄúStreet Food Freedom‚Äù event!</td>
            </tr>
          </tbody>
        </table>
        <section class="battle-section">
          <h2>üî•Holiday's Showdown Arena</h2>
          <p>Challenges friends' to duels and quests ‚Äî earn badges!</p>

          <nav>
            <a href="./TasteQuestCambodiamemory.html" class="nav-btn"
              >holiday-calendar</a
            >
          </nav>
        </section>
      </section>
    </main>

    <footer>
      <p>¬© 2025 Taste Quest: Cambodia | Play. Taste. Discover.</p>
    </footer>

    <script> 
(async () => {
  const debugMode = true; // Toggle console logs

  // Wait for CambodiaCultureLib to be loaded
  function waitForLib(timeout = 5000) {
    return new Promise((resolve, reject) => {
      const start = Date.now();
      const interval = setInterval(() => {
        if (window.CambodiaCultureLib) {
          clearInterval(interval);
          resolve(true);
        } else if (Date.now() - start > timeout) {
          clearInterval(interval);
          reject(
            new Error("‚ùå CambodiaCultureLib failed to load within timeout.")
          );
        }
      }, 100);
    });
  }

  // Render a list of holidays in HTML
  function renderHolidayList(holidays, containerId) {
    const container = document.getElementById(containerId);
    if (!container) return;

    container.innerHTML = holidays
      .map(
        (h) => `
      <li>
        <strong>${h.name}</strong> (${h.date}) ‚Äî ${
          h.tradition || "No tradition info"
        } 
        ${h.religion ? `<em>[${h.religion}]</em>` : ""}
      </li>
    `
      )
      .join("");
  }

  // Safe initialization
  async function initApp() {
    try {
      console.log("üåè Taste Quest: Cambodia ‚Äî Initializing cultural data...");

      await waitForLib();

      if (typeof CambodiaCultureLib.loadAll !== "function") {
        throw new Error(
          "‚ùå CambodiaCultureLib is missing the loadAll function."
        );
      }

      const data = await CambodiaCultureLib.loadAll();
      console.log("üìö Data loaded:", {
        provinces: data.provinces.length,
        nationalHolidays: data.holidays.length,
        religiousGroups: data.religions.length,
        events: data.events.length,
      });

      // Merge national + religious holidays
      const allHolidays = CambodiaCultureLib.mergeAllHolidays(
        data.holidays,
        data.religions
      );
      console.log(`üéâ Total combined holidays: ${allHolidays.length}`);

      // Optional: render in HTML
      renderHolidayList(allHolidays, "holiday-list");

      if (debugMode) {
        console.group("üóìÔ∏è Full Holiday Calendar");
        allHolidays.forEach((h) => {
          console.log(
            `‚Ä¢ ${h.name} (${h.date}) ${
              h.religion ? "[" + h.religion + "]" : ""
            }: ${h.tradition || "No tradition info"}`
          );
        });
        console.groupEnd();
      }

      // Optional: debug religious holidays only
      if (typeof CambodiaCultureLib.debugReligiousHolidays === "function") {
        await CambodiaCultureLib.debugReligiousHolidays();
      }

      console.log("‚úÖ Cultural data initialized successfully!");
    } catch (err) {
      console.error("‚ö†Ô∏è Initialization Error:", err.message);
      console.warn(
        "üõ†Ô∏è Tip: Check that cambodiaCultureLib.js is linked correctly and JSON data files exist in /data/"
      );
    }
  }

  // Run after DOM loads
  window.addEventListener("DOMContentLoaded", () => {
    initApp();
  });
})();
window.addEventListener("DOMContentLoaded", () => {
  console.log("üåè Starting Taste Quest Cambodia...");

  // Render Food Pyramid Selection
  CambodiaBattleLib.renderSelection("map-container");
});
window.addEventListener("DOMContentLoaded", async () => {
  console.log("üåè Taste Quest Cambodia - AR Event System Active");

  // Load holidays into AR Event System
  await CambodiaAREventLib.loadHolidays();

  // Simulate daily event check
  CambodiaAREventLib.update();

  // Auto-check every minute (like a live game world)
  setInterval(() => CambodiaAREventLib.update(), 60000);

  // Example: Manual event interaction
  document.body.addEventListener("click", () => {
    if (CambodiaAREventLib.activeEvents.length > 0) {
      const event = CambodiaAREventLib.activeEvents[0];
      CambodiaAREventLib.interactWithEvent(event.id);
    }
  });
});
window.addEventListener("DOMContentLoaded", async () => {
  console.log("üåè Taste Quest Cambodia - Unreal Integration Active");

  // Initialize Unreal Bridge
  UnrealBridge.init();
  UnrealBridge.registerBlueprintEvents();

  // Example: Sync player state on load
  UnrealBridge.syncPlayerState(CambodiaMapLib.getPlayerState());

  // Hook AR event triggers to Unreal
  document.body.addEventListener("click", () => {
    if (CambodiaAREventLib.activeEvents.length > 0) {
      const event = CambodiaAREventLib.activeEvents[0];
      UnrealBridge.triggerAREvent(event);
      CambodiaAREventLib.interactWithEvent(event.id);
    }
  });
});

//(Optional) Expose camera scanning results:If you detect a landmark like Angkor Wat, call//
window.dispatchEvent(
  new CustomEvent("ARScanSuccess", {
    detail: { holidayName: "Khmer New Year" },
  })
);
// 25 region names
const regions = [
  "Phnom Penh",
  "Siem Reap",
  "Battambang",
  "Kampot",
  "Kandal",
  "Takeo",
  "Kampong Cham",
  "Kampong Thom",
  "Kampong Chhnang",
  "Koh Kong",
  "Kratie",
  "Mondulkiri",
  "Oddar Meanchey",
  "Pailin",
  "Preah Vihear",
  "Prey Veng",
  "Pursat",
  "Ratanakiri",
  "Sihanoukville",
  "Stung Treng",
  "Svay Rieng",
  "Tbong Khmum",
  "Kep",
  "Banteay Meanchey",
  "Poipet District",
];

const select = document.getElementById("province-select");
regions.forEach((r) => {
  const opt = document.createElement("option");
  opt.textContent = r;
  opt.value = r;
  select.appendChild(opt);
});

select.addEventListener("change", () => {
  const name = select.value;
  document.getElementById("selected-province").textContent =
    name || "No Region Selected";
  document.getElementById("province-details").textContent = name
    ? `${name} is known for its unique culinary style and food pyramid battles!`
    : "Pick a region to view its food quest and battle opportunities.";
});

// Simple battle simulator
document.getElementById("start-battle").addEventListener("click", () => {
  const outcomes = [
    "You cooked a masterpiece! üèÜ",
    "The rival chef outcooked you! üî•",
    "It‚Äôs a tie! Both dishes impressed! üçõ",
  ];
  const result = outcomes[Math.floor(Math.random() * outcomes.length)];
  document.getElementById("battle-result").textContent = result;
});
const CambodiaCalendarLib = (() => {
  // Utility: Safe parse month from holiday date
  function getMonthFromDate(dateStr) {
    try {
      const date = new Date(dateStr);
      if (isNaN(date)) return null;
      return date.getMonth(); // 0 = Jan, 11 = Dec
    } catch {
      return null;
    }
  }

  // Generate a month-based calendar from holidays
  function generateCalendar(holidays = []) {
    const months = Array.from({ length: 12 }, (_, i) => ({
      month: new Date(0, i).toLocaleString("default", { month: "long" }),
      holidays: [],
    }));

    holidays.forEach((h) => {
      const monthIndex = getMonthFromDate(h.date);
      if (monthIndex !== null) {
        months[monthIndex].holidays.push(h);
      }
    });

    return months;
  }

  // Render calendar to HTML
  function renderCalendarHTML(months, containerId) {
    const container = document.getElementById(containerId);
    if (!container) return;

    container.innerHTML = months
      .map(
        (m) => `
      <div class="calendar-month">
        <h3>${m.month}</h3>
        ${
          m.holidays.length > 0
            ? `<ul>${m.holidays
                .map(
                  (h) => `
            <li>
              <strong>${h.name}</strong> (${h.date}) 
              ${h.religion ? `<em>[${h.religion}]</em>` : ""}
              : ${h.tradition || "No tradition info"}
            </li>`
                )
                .join("")}</ul>`
            : "<p>No holidays</p>"
        }
      </div>
    `
      )
      .join("");
  }

  // Filter holidays by province
  function getHolidaysByProvince(holidays, provinceName) {
    return holidays.filter(
      (h) =>
        h.province?.toLowerCase() === provinceName.toLowerCase() || !h.province
    );
  }

  // Filter holidays by religion
  function getHolidaysByReligion(holidays, religionName) {
    return holidays.filter(
      (h) => h.religion?.toLowerCase() === religionName.toLowerCase()
    );
  }

  // Get upcoming holidays from today
  function getUpcomingHolidays(holidays, fromDate = new Date()) {
    return holidays
      .filter((h) => {
        const d = new Date(h.date);
        return !isNaN(d) && d >= fromDate;
      })
      .sort((a, b) => new Date(a.date) - new Date(b.date));
  }

  // Safe wrapper for external holiday list
  async function loadAndGenerateCalendar() {
    try {
      if (
        !window.CambodiaCultureLib ||
        typeof CambodiaCultureLib.loadAll !== "function"
      ) {
        throw new Error(
          "CambodiaCultureLib not loaded or missing loadAll function."
        );
      }

      const data = await CambodiaCultureLib.loadAll();
      const allHolidays = CambodiaCultureLib.mergeAllHolidays(
        data.holidays,
        data.religions
      );

      return generateCalendar(allHolidays);
    } catch (err) {
      console.error("‚ö†Ô∏è Calendar generation failed:", err.message);
      return Array.from({ length: 12 }, (_, i) => ({
        month: new Date(0, i).toLocaleString("default", { month: "long" }),
        holidays: [],
      }));
    }
  }

  // Export functions
  return {
    generateCalendar,
    renderCalendarHTML,
    getHolidaysByProvince,
    getHolidaysByReligion,
    getUpcomingHolidays,
    loadAndGenerateCalendar,
  };
})();
const UnrealBridge = (() => {
  let isConnected = false;

  // Simulated UE interface (used when testing in browser)
  const mockUE = {
    Interface: {
      emit: (event, payload) =>
        console.log(`üéÆ [Mock UE Emit] ${event}:`, payload),
    },
  };

  // Safely detect UE interface
  function getUE() {
    try {
      return window.ue || window.UE || mockUE;
    } catch {
      return mockUE;
    }
  }

  // Initialize connection
  function init() {
    const UE = getUE();
    if (UE && UE.Interface) {
      isConnected = true;
      console.log("‚úÖ Unreal Engine Bridge Connected");
      emit("GameInit", { message: "Taste Quest Cambodia initialized." });
    } else {
      console.warn("‚ö†Ô∏è Unreal Engine not detected, running in browser mode.");
    }
  }

  // Emit event to Unreal Engine
  function emit(eventName, data = {}) {
    try {
      const UE = getUE();
      const payload = typeof data === "string" ? data : JSON.stringify(data);
      UE.Interface.emit(eventName, payload);
    } catch (error) {
      console.error(`‚ùå Failed to emit event '${eventName}'`, error);
    }
  }

  // Listen for events from Unreal Engine (e.g., camera scan, AR trigger)
  function listen(eventName, callback) {
    try {
      window.addEventListener(eventName, (e) => {
        console.log(`üéß Received from UE: ${eventName}`, e.detail);
        callback(e.detail);
      });
    } catch (error) {
      console.error("‚ùå Failed to attach UE listener", error);
    }
  }

  // Example: Trigger AR Event from JS ‚Üí Unreal
  function triggerAREvent(eventData) {
    emit("AREventTriggered", eventData);
  }

  // Example: Handle AR scan success from Unreal ‚Üí JS
  function handleARScan(result) {
    if (result && result.holidayName) {
      console.log(`üì∑ AR Scan recognized: ${result.holidayName}`);
      CambodiaAREventLib.triggerAREvent({ name: result.holidayName });
    }
  }

  // Example: Send player stats to Unreal
  function syncPlayerState(playerState) {
    emit("PlayerStateSync", playerState);
  }

  // Example: Receive event from Unreal (for future expansion)
  function registerBlueprintEvents() {
    listen("ARScanSuccess", handleARScan);
  }

  return {
    init,
    emit,
    listen,
    triggerAREvent,
    syncPlayerState,
    registerBlueprintEvents,
    isConnected,
  };
})();
const CambodiaMapLib = (() => {
  // Province data (start small, extendable later)
  const provinces = [
    {
      id: "angkor_wat",
      name: "Angkor Wat",
      type: "start",
      unlocked: true,
      description: "The sacred temple city, start your adventure here!",
      badge: "Explorer Badge",
      events: [
        {
          id: "food_start",
          name: "Pick your first food pyramid!",
          type: "startEvent",
        },
      ],
    },
    {
      id: "battambang",
      name: "Battambang",
      type: "region",
      unlocked: false,
      description: "Famous for local cuisine and cultural events.",
      badge: "Culinary Badge",
      events: [],
    },
    {
      id: "phnom_penh",
      name: "Phnom Penh",
      type: "region",
      unlocked: false,
      description: "The capital city, home to urban food challenges.",
      badge: "Urban Explorer Badge",
      events: [],
    },
  ];

  // Current player state
  const playerState = {
    currentProvince: "angkor_wat",
    badges: [],
    unlockedProvinces: ["angkor_wat"],
    collectedFoods: [],
  };

  // Unlock a province
  function unlockProvince(provinceId) {
    const province = provinces.find((p) => p.id === provinceId);
    if (province && !playerState.unlockedProvinces.includes(provinceId)) {
      province.unlocked = true;
      playerState.unlockedProvinces.push(provinceId);
      console.log(`üéâ Province unlocked: ${province.name}`);
    }
  }

  // Move to a province
  function travelToProvince(provinceId) {
    const province = provinces.find((p) => p.id === provinceId);
    if (!province) return console.warn("‚ùå Province not found");
    if (!province.unlocked)
      return console.warn("üö´ Province locked! Complete challenges to unlock.");

    playerState.currentProvince = provinceId;
    console.log(`üó∫Ô∏è Traveled to ${province.name}`);

    // Trigger any events in this province
    province.events.forEach((event) => triggerEvent(event));
  }

  // Trigger an event
  function triggerEvent(event) {
    console.log(`‚ö° Event triggered: ${event.name} [${event.type}]`);

    // Example: start event for first food choice
    if (event.type === "startEvent") {
      console.log("üç≤ Pick your first food pyramid to begin your adventure!");
    }
  }

  // Display provinces in console or for Unreal Engine UI
  function displayProvinces() {
    provinces.forEach((p) => {
      console.log(
        `‚Ä¢ ${p.name} [${p.unlocked ? "Unlocked" : "Locked"}] - ${p.description}`
      );
    });
  }

  // Award badge
  function awardBadge(badgeName) {
    if (!playerState.badges.includes(badgeName)) {
      playerState.badges.push(badgeName);
      console.log(`üèÖ Badge earned: ${badgeName}`);
    }
  }

  // Get current player state
  function getPlayerState() {
    return { ...playerState };
  }

  // Exported functions
  return {
    provinces,
    playerState,
    unlockProvince,
    travelToProvince,
    displayProvinces,
    awardBadge,
    getPlayerState,
  };
})();
const CambodiaCultureLib = (() => {
  const DATA_PATHS = {
    provinces: "data/provinces.json",
    holidays: "data/holidays.json",
    religions: "data/religious_holidays.json",
    events: "data/events.json",
  };

  const debugMode = true; // ‚úÖ Toggle this to false in production

  // ============ DATA LOADERS ============

  async function loadData(path) {
    try {
      const response = await fetch(path);
      if (!response.ok)
        throw new Error(`‚ùå Failed to fetch ${path}: ${response.status}`);
      const data = await response.json();
      if (debugMode) console.log(`‚úÖ Loaded: ${path}`);
      return data;
    } catch (err) {
      console.error(`‚ö†Ô∏è Error loading ${path}:`, err);
      return []; // Return empty array instead of crashing
    }
  }

  async function loadAll() {
    const [provinces, holidays, religions, events] = await Promise.all([
      loadData(DATA_PATHS.provinces),
      loadData(DATA_PATHS.holidays),
      loadData(DATA_PATHS.religions),
      loadData(DATA_PATHS.events),
    ]);
    return { provinces, holidays, religions, events };
  }

  // ============ FILTER FUNCTIONS ============

  function getProvinceByName(provinces, name) {
    return provinces.find((p) => p.name?.toLowerCase() === name.toLowerCase());
  }

  function getHolidaysByMonth(holidays, monthName) {
    return holidays.filter((h) =>
      h.date?.toLowerCase().includes(monthName.toLowerCase())
    );
  }

  function getReligiousHolidays(religions, religionName) {
    const group = religions.find(
      (r) => r.religion?.toLowerCase() === religionName.toLowerCase()
    );
    return group ? group.holidays : [];
  }

  function getEventsByHoliday(events, holidayName) {
    return events.filter(
      (e) => e.holiday?.toLowerCase() === holidayName.toLowerCase()
    );
  }

  function getEventsByProvince(events, provinceName) {
    return events.filter(
      (e) => e.province?.toLowerCase() === provinceName.toLowerCase()
    );
  }

  // ============ LOGIC / FORMULA UTILITIES ============

  function getActiveEvents(events, holidays, currentDate = new Date()) {
    const currentMonth = currentDate
      .toLocaleString("default", { month: "long" })
      .toLowerCase();
    return events.filter((ev) =>
      holidays.some(
        (h) =>
          ev.holiday?.toLowerCase() === h.name?.toLowerCase() &&
          h.date?.toLowerCase().includes(currentMonth)
      )
    );
  }

  function mergeAllHolidays(holidays, religions) {
    const religiousHolidays = religions.flatMap((r) =>
      r.holidays.map((h) => ({
        ...h,
        religion: r.religion,
        type: "Religious",
      }))
    );
    return [...holidays, ...religiousHolidays];
  }

  // ============ DEBUG LOGGER FOR RELIGIOUS HOLIDAYS ============

  async function debugReligiousHolidays() {
    try {
      const religions = await loadData(DATA_PATHS.religions);
      if (!Array.isArray(religions) || religions.length === 0) {
        console.warn("‚ö†Ô∏è No religious holidays found or file is empty.");
        return;
      }

      console.group("üïå Religious & Cultural Holiday Data");
      religions.forEach((r) => {
        console.log(`\n=== ${r.religion} ===`);
        if (Array.isArray(r.holidays)) {
          r.holidays.forEach((h) => {
            console.log(`‚Ä¢ ${h.name} (${h.date}): ${h.tradition}`);
          });
        } else {
          console.warn(`No holidays listed for ${r.religion}`);
        }
      });
      console.groupEnd();
    } catch (err) {
      console.error("‚ùå Error during religious holiday debug load:", err);
    }
  }

  // ============ UTILITY HELPERS ============

  function formatHoliday(holiday) {
    return `${holiday.name} (${holiday.date}) ‚Äî ${holiday.tradition}`;
  }

  function listHolidays(holidays) {
    return holidays.map((h) => formatHoliday(h)).join("\n");
  }

  // ============ MAIN EXPORTS ============

  return {
    loadAll,
    getProvinceByName,
    getHolidaysByMonth,
    getReligiousHolidays,
    getEventsByHoliday,
    getEventsByProvince,
    getActiveEvents,
    mergeAllHolidays,
    listHolidays,
    debugReligiousHolidays,
  };
})();

// ‚úÖ Example use (you can comment this out later)
async function initCultureData() {
  try {
    const data = await CambodiaCultureLib.loadAll();
    console.log("‚úÖ All cultural data loaded successfully!");
    console.log("üìç Provinces:", data.provinces.length);
    console.log("üéâ National Holidays:", data.holidays.length);
    console.log("üïäÔ∏è Religious Groups:", data.religions.length);

    // Run debug print for religious holidays
    await CambodiaCultureLib.debugReligiousHolidays();
  } catch (err) {
    console.error("‚ùå Error initializing cultural data:", err);
  }
}

// Uncomment this for testing
// initCultureData();

const CambodiaChallengeLib = (() => {
  const challenges = []; // All active challenges

  // Create a new challenge
  function createChallenge({ id, provinceId, name, type, rewardBadge, date }) {
    const challenge = {
      id,
      provinceId,
      name,
      type, // e.g., 'food', 'chef', 'holiday'
      rewardBadge,
      date, // Optional: date to trigger challenge (holiday)
      completed: false,
    };
    challenges.push(challenge);
    return challenge;
  }

  // Trigger challenges for a province
  function triggerProvinceChallenges(provinceId, playerState) {
    const active = challenges.filter(
      (c) => c.provinceId === provinceId && !c.completed
    );
    active.forEach((c) => {
      console.log(`‚ö° Challenge started in ${provinceId}: ${c.name}`);
      // Example: prompt player for challenge
      // For Unreal Engine, this can trigger a UI event
    });
    return active;
  }

  // Complete a challenge
  function completeChallenge(challengeId, playerState) {
    const challenge = challenges.find((c) => c.id === challengeId);
    if (!challenge) return console.warn("‚ùå Challenge not found");
    if (challenge.completed)
      return console.warn("‚úÖ Challenge already completed");

    challenge.completed = true;

    // Award badge if defined
    if (challenge.rewardBadge) {
      playerState.badges.push(challenge.rewardBadge);
      console.log(`üèÖ Badge awarded: ${challenge.rewardBadge}`);
    }
  }

  // Generate holiday-triggered challenges
  function createHolidayChallenges(holidays, provinceId) {
    holidays.forEach((h) => {
      const id = `holiday_${provinceId}_${h.name.replace(/\s+/g, "_")}`;
      createChallenge({
        id,
        provinceId,
        name: `Holiday Event: ${h.name}`,
        type: "holiday",
        rewardBadge: `${h.name} Participant`,
        date: h.date,
      });
    });
  }

  // Check and trigger upcoming holiday challenges
  function triggerUpcomingHolidayChallenges(
    playerState,
    currentDate = new Date()
  ) {
    const upcoming = challenges.filter(
      (c) =>
        c.type === "holiday" && !c.completed && new Date(c.date) >= currentDate
    );

    upcoming.forEach((c) => {
      console.log(
        `üéâ Upcoming Holiday Challenge: ${c.name} in ${c.provinceId}`
      );
      // For Unreal Engine, can trigger AR or UI event
    });
  }

  // Get all challenges for a province
  function getProvinceChallenges(provinceId) {
    return challenges.filter((c) => c.provinceId === provinceId);
  }

  // Get player completed challenges
  function getCompletedChallenges() {
    return challenges.filter((c) => c.completed);
  }

  return {
    challenges,
    createChallenge,
    completeChallenge,
    triggerProvinceChallenges,
    createHolidayChallenges,
    triggerUpcomingHolidayChallenges,
    getProvinceChallenges,
    getCompletedChallenges,
  };
})();
   
const CambodiaBattleLib = (() => {
  // Food pyramid starter choices
  const foodPyramids = [
    {
      id: "rice_hero",
      name: "Rice Hero üçö",
      type: "Grain",
      strength: 8,
      weakness: "Spice",
      region: "Angkor Wat",
      description: "The foundation of Cambodian cuisine ‚Äî strong and balanced.",
    },
    {
      id: "spice_master",
      name: "Spice Master üå∂Ô∏è",
      type: "Spice",
      strength: 10,
      weakness: "Sweet",
      region: "Battambang",
      description: "Brings fire and flavor. Dominates bland opponents!",
    },
    {
      id: "sweet_guardian",
      name: "Sweet Guardian üç¨",
      type: "Dessert",
      strength: 7,
      weakness: "Savory",
      region: "Phnom Penh",
      description: "Kind but deadly. Sweet victory awaits!",
    },
  ];

  // Player state
  const player = {
    selectedFood: null,
    battleWins: 0,
    battleLosses: 0,
  };

  // Select your starter food
  function selectFoodPyramid(foodId) {
    const choice = foodPyramids.find((f) => f.id === foodId);
    if (!choice) return console.warn("‚ùå Food not found");

    player.selectedFood = choice;
    console.log(`üçΩÔ∏è You selected: ${choice.name}`);
    return choice;
  }

  // Start a chef battle
  function startBattle(opponentFood) {
    if (!player.selectedFood) {
      console.warn("‚ö†Ô∏è No starter food selected.");
      return {
        result: "none",
        message: "Please select your food pyramid first.",
      };
    }

    // Basic stat-based battle system
    const playerStrength =
      player.selectedFood.strength + Math.floor(Math.random() * 4);
    const opponentStrength =
      opponentFood.strength + Math.floor(Math.random() * 4);

    let result;
    if (playerStrength > opponentStrength) {
      player.battleWins++;
      result = {
        result: "win",
        message: `üèÜ You won! ${player.selectedFood.name} beats ${opponentFood.name}!`,
      };
    } else {
      player.battleLosses++;
      result = {
        result: "lose",
        message: `üíÄ You lost! ${opponentFood.name} overpowered you.`,
      };
    }

    console.log(result.message);
    return result;
  }

  // Generate random opponent from available foods
  function generateOpponent() {
    const options = foodPyramids.filter(
      (f) => f.id !== player.selectedFood?.id
    );
    const random = options[Math.floor(Math.random() * options.length)];
    console.log(`üë®‚Äçüç≥ Opponent chosen: ${random.name}`);
    return random;
  }

  // Render food pyramid selection (UI friendly)
  function renderSelection(containerId) {
    const container = document.getElementById(containerId);
    if (!container) return;

    container.innerHTML = "<h2>Select Your Food Pyramid</h2>";

    foodPyramids.forEach((food) => {
      const card = document.createElement("div");
      card.className = "food-card";
      card.innerHTML = `
        <h3>${food.name}</h3>
        <p>${food.description}</p>
        <button class="select-btn" data-id="${food.id}">Choose</button>
      `;
      container.appendChild(card);
    });

    // Button listeners
    container.querySelectorAll(".select-btn").forEach((btn) => {
      btn.addEventListener("click", (e) => {
        const food = selectFoodPyramid(e.target.dataset.id);
        container.innerHTML = `<h3>üçΩÔ∏è You selected ${food.name}</h3><p>${food.description}</p>`;
        startBattleUI();
      });
    });
  }

  // Start battle UI
  function startBattleUI() {
    const battleContainer = document.createElement("div");
    battleContainer.className = "battle-container";
    document.body.appendChild(battleContainer);

    const opponent = generateOpponent();
    const btn = document.createElement("button");
    btn.textContent = "Start Chef Battle!";
    btn.className = "battle-btn";
    btn.onclick = () => {
      const result = startBattle(opponent);
      battleContainer.innerHTML = `<h2>${result.message}</h2>`;
      if (result.result === "win") {
        CambodiaMapLib.unlockProvince("battambang");
        CambodiaChallengeLib.createChallenge({
          id: "battambang_food_challenge",
          provinceId: "battambang",
          name: "First Regional Chef Battle",
          type: "chef",
          rewardBadge: "Regional Chef Badge",
        });
      }
    };
    battleContainer.appendChild(btn);
  }

  return {
    foodPyramids,
    player,
    selectFoodPyramid,
    startBattle,
    generateOpponent,
    renderSelection,
  };
})();
const CambodiaAREventLib = (() => {
  const activeEvents = [];
  let holidaysCache = [];

  // Fetch and cache holidays
  async function loadHolidays() {
    try {
      const months = await CambodiaCalendarLib.loadAndGenerateCalendar();
      holidaysCache = months.flatMap((m) => m.holidays || []);
      console.log(
        `üìÖ Loaded ${holidaysCache.length} holidays into AR Event System.`
      );
    } catch (error) {
      console.error("‚ùå Failed to load holidays for AR system:", error);
    }
  }

  // Detect current or upcoming holiday
  function detectActiveHoliday(currentDate = new Date()) {
    const today = currentDate.toISOString().split("T")[0];
    const currentHoliday = holidaysCache.find((h) => h.date === today);
    if (currentHoliday) {
      console.log(`üéâ Active Holiday: ${currentHoliday.name}`);
      triggerAREvent(currentHoliday);
      return currentHoliday;
    }
    return null;
  }

  // Trigger AR event
  function triggerAREvent(holiday) {
    if (!holiday) return;
    if (activeEvents.find((e) => e.id === holiday.name)) {
      console.log(`üåÄ AR Event for ${holiday.name} already active.`);
      return;
    }

    const newEvent = {
      id: holiday.name,
      name: holiday.name,
      type: "holiday",
      description: holiday.tradition || "Cultural celebration.",
      reward: `${holiday.name} Collector Badge`,
      active: true,
      province: holiday.province || "nationwide",
    };

    activeEvents.push(newEvent);
    console.log(`‚ú® New AR Event: ${newEvent.name} (${newEvent.province})`);

    // Example: trigger chef battle or collectible challenge
    CambodiaChallengeLib.createChallenge({
      id: `holiday_event_${holiday.name.replace(/\s+/g, "_")}`,
      provinceId: newEvent.province,
      name: `${holiday.name} Celebration Challenge`,
      type: "holiday",
      rewardBadge: newEvent.reward,
    });

    // Hook for Unreal Engine ‚Äî broadcast event
    if (window.UE && window.UE.Interface) {
      window.UE.Interface.emit(
        "HolidayEventTriggered",
        JSON.stringify(newEvent)
      );
    }
  }

  // Simulate AR interaction (works in browser or Unreal)
  function interactWithEvent(eventId) {
    const event = activeEvents.find((e) => e.id === eventId);
    if (!event) return console.warn("‚ùå No such AR event.");

    console.log(`üìç Interacting with ${event.name}`);
    event.active = false;

    // Reward the player
    CambodiaMapLib.awardBadge(event.reward);

    // AR animation trigger (browser or Unreal)
    if (window.UE && window.UE.Interface) {
      window.UE.Interface.emit("AREventCompleted", JSON.stringify(event));
    }
  }

  // Update (used in main loop or Unreal tick)
  async function update() {
    if (!holidaysCache.length) await loadHolidays();
    detectActiveHoliday();
  }

  // Expose public functions
  return {
    loadHolidays,
    detectActiveHoliday,
    triggerAREvent,
    interactWithEvent,
    update,
    activeEvents,
  };
})();

    </script>
   
  </body>
</html>



