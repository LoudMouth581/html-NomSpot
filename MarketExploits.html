<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sci-Fi True Crime Financial Timeline & Corruption Map</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Orbitron&display=swap');

    :root {
      --tech: #00bcd4;
      --politics: #ff5722;
      --crime: #8e44ad;
      --finance: #ffd700;
      --influencer: #9c27b0;
      --surveillance: #4caf50;

      --bg: #0a0a0a;
      --card: #1f1f1f;
      --text: #eee;
      --accent: #00ffff;
      --highlight: #ff4081;
      --fade: #444;
    }

    /* Light Mode Overrides */
    body.light {
      --bg: #e6e6e6;
      --card: #f9f9f9;
      --text: #111;
      --accent: #0077cc;
      --highlight: #cc0066;
      --fade: #bbb;
    }

    body {
      margin: 0;
      padding: 0;
      background: var(--bg);
      color: var(--text);
      font-family: 'Orbitron', sans-serif;
      overflow-x: hidden;
      transition: background-color 0.5s ease, color 0.5s ease;
      user-select: none;
    }

    h1 {
      text-align: center;
      padding: 1rem 0 0.5rem;
      color: var(--accent);
      text-shadow: 0 0 10px var(--accent);
      user-select: none;
      transition: color 0.5s ease, text-shadow 0.5s ease;
    }

    /* Dark/Light toggle button */
    .toggle-btn {
      position: fixed;
      top: 10px;
      right: 10px;
      padding: 0.6rem 1rem;
      font-family: 'Orbitron', sans-serif;
      font-weight: 700;
      font-size: 14px;
      border: none;
      border-radius: 6px;
      background: var(--card);
      color: var(--accent);
      cursor: pointer;
      user-select: none;
      transition: background-color 0.3s ease, color 0.3s ease;
      z-index: 9999;
      box-shadow:
        0 0 8px var(--accent);
    }

    .toggle-btn:hover {
      background-color: var(--accent);
      color: var(--bg);
    }

    /* Timeline Controls */
    .controls {
      text-align: center;
      padding: 0 0 1rem;
    }

    .controls input,
    .controls button {
      margin: 0.3rem;
      padding: 0.6rem 1rem;
      font-size: 14px;
      border: none;
      border-radius: 5px;
      font-family: 'Orbitron', sans-serif;
      background: var(--card);
      color: var(--accent);
      cursor: pointer;
      transition: background-color 0.3s ease, color 0.3s ease;
      user-select: text;
    }

    .controls input:focus,
    .controls button:hover {
      background-color: var(--accent);
      color: var(--bg);
      outline: none;
    }

    /* Timeline */
    .timeline {
      display: flex;
      flex-direction: row;
      flex-wrap: wrap;
      gap: 1rem;
      justify-content: center;
      padding: 1rem;
      max-width: 1200px;
      margin: 0 auto 3rem;
    }

    @media (max-width: 600px) {
      .timeline {
        flex-direction: column;
        padding: 1rem 0.5rem;
      }
    }

    /* Event Cards (clue card style) */
    .event {
      background: var(--card);
      border-radius: 12px;
      border-left: 8px solid;
      padding: 1rem 1.2rem 1.4rem;
      width: 280px;
      position: relative;
      transition: transform 0.3s ease, box-shadow 0.3s ease, opacity 0.4s ease, border-color 0.3s ease;
      cursor: pointer;
      box-shadow:
        inset 0 0 5px rgba(255, 255, 255, 0.05),
        0 0 15px rgba(0, 255, 255, 0.15);
      user-select: text;
    }

    .event:hover {
      transform: scale(1.07);
      box-shadow:
        inset 0 0 12px rgba(0, 255, 255, 0.4),
        0 0 35px var(--accent);
      z-index: 10;
    }

    /* Color-coded borders by sector */
    .event.tech {
      border-color: var(--tech);
    }

    .event.politics {
      border-color: var(--politics);
    }

    .event.crime {
      border-color: var(--crime);
    }

    .event.finance {
      border-color: var(--finance);
    }

    .event.influencer {
      border-color: var(--influencer);
    }

    .event.surveillance {
      border-color: var(--surveillance);
    }

    /* Text styling */
    .event h3 {
      margin: 0 0 0.4rem 0;
      font-size: 1.2rem;
      color: var(--accent);
      text-shadow: 0 0 8px var(--accent);
      user-select: text;
      line-height: 1.1;
    }

    .event small {
      display: block;
      color: #999;
      margin-bottom: 0.8rem;
      font-family: monospace;
      user-select: text;
      font-weight: 600;
      letter-spacing: 0.05em;
    }

    .event p {
      font-size: 0.9rem;
      line-height: 1.3;
      user-select: text;
      min-height: 58px;
    }

    .event a {
      color: var(--accent);
      font-size: 0.85rem;
      text-decoration: underline;
      display: inline-block;
      margin-top: 0.6rem;
      user-select: text;
    }

    /* Hidden class for filtering */
    .hidden {
      opacity: 0.15 !important;
      pointer-events: none;
      transform: scale(0.95);
      transition: opacity 0.3s ease, transform 0.3s ease;
    }

    /* Highlight for selected cards */
    .highlight {
      border-left-color: var(--highlight) !important;
      box-shadow:
        inset 0 0 15px var(--highlight),
        0 0 40px var(--highlight);
      opacity: 1 !important;
      transform: scale(1.1);
      z-index: 20;
      transition: all 0.3s ease;
    }

    /* Graph Title */
    #graphTitle {
      text-align: center;
      color: var(--accent);
      font-size: 1.8rem;
      font-weight: 700;
      margin-bottom: 0.4rem;
      user-select: none;
      text-shadow: 0 0 15px var(--accent);
      transition: color 0.5s ease, text-shadow 0.5s ease;
    }

    /* Graph container */
    #graph {
      width: 100%;
      height: 600px;
      background: linear-gradient(135deg, #050505 0%, #101820 100%);
      box-shadow: 0 0 50px #00fff7 inset;
      border-radius: 16px;
      margin: 0 auto 3rem;
      max-width: 1200px;
      position: relative;
      user-select: none;
      transition: background 0.5s ease;
    }

    /* Light mode graph background */
    body.light #graph {
      background: linear-gradient(135deg, #f0f4f8 0%, #c7d1dc 100%);
      box-shadow: 0 0 30px #0077cc inset;
    }

    /* Tooltip */
    .tooltip {
      position: absolute;
      pointer-events: none;
      background: rgba(0, 255, 255, 0.9);
      color: #000;
      padding: 6px 10px;
      border-radius: 5px;
      font-family: 'Orbitron', monospace;
      font-size: 13px;
      text-align: center;
      opacity: 0;
      transition: opacity 0.25s ease;
      user-select: none;
      z-index: 1000;
      white-space: nowrap;
    }
  </style>
</head>
<body>
  <button class="toggle-btn" id="darkToggle">Dark Mode</button>
  <h1>Financial Crime Timeline & Corruption Map</h1>
  <div class="controls">
    <input id="search" type="text" placeholder="Search by keyword..." aria-label="Search events" />
    <button id="clearSearch">Clear</button>
  </div>
  <div class="timeline" id="timeline"></div>
  <h2 id="graphTitle">Corruption Network Map</h2>
  <div id="graph"></div>
  <div class="tooltip" id="tooltip"></div>

<script>
(() => {
  // Data: events and network nodes/links
  const events = [
    {
      id: 'ev1', date: '2024-01-05', title: 'Tech CEO under investigation',
      sector: 'tech',
      description: 'Suspicious financial transactions linked to offshore accounts.',
      link: 'https://example.com/tech-ceo-investigation'
    },
    {
      id: 'ev2', date: '2024-01-20', title: 'Political scandal emerges',
      sector: 'politics',
      description: 'Leaks reveal corruption in election funding.',
      link: 'https://example.com/political-scandal'
    },
    {
      id: 'ev3', date: '2024-02-12', title: 'Crime boss arrested',
      sector: 'crime',
      description: 'Arrest after a multi-year investigation into money laundering.',
      link: 'https://example.com/crime-boss-arrest'
    },
    {
      id: 'ev4', date: '2024-03-02', title: 'Financial fraud uncovered',
      sector: 'finance',
      description: 'Audit finds millions missing from company accounts.',
      link: 'https://example.com/financial-fraud'
    },
    {
      id: 'ev5', date: '2024-04-18', title: 'Influencer linked to fake charities',
      sector: 'influencer',
      description: 'Charity scams disguised as social campaigns.',
      link: 'https://example.com/influencer-charity'
    },
    {
      id: 'ev6', date: '2024-05-23', title: 'Surveillance breach scandal',
      sector: 'surveillance',
      description: 'Unauthorized data harvesting revealed.',
      link: 'https://example.com/surveillance-breach'
    }
  ];

  // Nodes: represent figures/entities linked to events
  const nodes = [
    { id: 'n1', name: 'John Techman', sector: 'tech' },
    { id: 'n2', name: 'Senator Roberts', sector: 'politics' },
    { id: 'n3', name: 'Vito Crime', sector: 'crime' },
    { id: 'n4', name: 'Emma Finance', sector: 'finance' },
    { id: 'n5', name: 'Luna Influencer', sector: 'influencer' },
    { id: 'n6', name: 'Agent X', sector: 'surveillance' }
  ];

  // Links: connections between nodes
  const links = [
    { source: 'n1', target: 'n2' },
    { source: 'n2', target: 'n3' },
    { source: 'n3', target: 'n4' },
    { source: 'n4', target: 'n5' },
    { source: 'n5', target: 'n6' },
    { source: 'n6', target: 'n1' }, // loop back
    { source: 'n2', target: 'n5' },
    { source: 'n3', target: 'n6' }
  ];

  // Map event ID to related node IDs (for highlight syncing)
  const eventToNodesMap = {
    ev1: ['n1'],
    ev2: ['n2'],
    ev3: ['n3'],
    ev4: ['n4'],
    ev5: ['n5'],
    ev6: ['n6']
  };

  const timelineEl = document.getElementById('timeline');
  const tooltip = document.getElementById('tooltip');
  const graphEl = document.getElementById('graph');
  const searchInput = document.getElementById('search');
  const clearSearchBtn = document.getElementById('clearSearch');
  const darkToggleBtn = document.getElementById('darkToggle');
  const bodyEl = document.body;

  // Render timeline clue cards
  function renderTimeline(events) {
    timelineEl.innerHTML = '';
    events.forEach(ev => {
      const card = document.createElement('div');
      card.className = `event ${ev.sector}`;
      card.dataset.id = ev.id;
      card.innerHTML = `
        <h3>${ev.title}</h3>
        <small>${ev.date}</small>
        <p>${ev.description}</p>
        <a href="${ev.link}" target="_blank" rel="noopener noreferrer">More info</a>
      `;
      timelineEl.appendChild(card);

      // Click highlights related nodes on graph
      card.addEventListener('click', () => {
        clearHighlights();
        card.classList.add('highlight');
        highlightNodes(eventToNodesMap[ev.id] || []);
      });
    });
  }

  // Clear all highlights from cards and nodes
  function clearHighlights() {
    document.querySelectorAll('.event.highlight').forEach(c => c.classList.remove('highlight'));
    nodes.forEach(n => n.highlighted = false);
    renderGraph();
  }

  // Filter timeline cards by search
  function filterTimeline(query) {
    const q = query.trim().toLowerCase();
    document.querySelectorAll('.event').forEach(card => {
      const text = card.textContent.toLowerCase();
      if(text.includes(q)) {
        card.classList.remove('hidden');
      } else {
        card.classList.add('hidden');
      }
    });
  }

  // Highlight nodes on graph by IDs
  function highlightNodes(nodeIds) {
    nodes.forEach(n => {
      n.highlighted = nodeIds.includes(n.id);
    });
    renderGraph();
  }

  // Graph rendering
  // Use SVG for scalable vector, no canvas
  let svg, width, height;
  const nodeRadius = 18;

  function createSVG() {
    svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
    svg.setAttribute('width', '100%');
    svg.setAttribute('height', '100%');
    graphEl.innerHTML = '';
    graphEl.appendChild(svg);
    width = graphEl.clientWidth;
    height = graphEl.clientHeight;
  }

  // Position nodes in a circle for simplicity
  function getNodePositions() {
    const cx = width / 2;
    const cy = height / 2;
    const r = Math.min(cx, cy) - 60;
    const angleStep = (2 * Math.PI) / nodes.length;
    return nodes.map((node, i) => {
      return {
        ...node,
        x: cx + r * Math.cos(i * angleStep - Math.PI / 2),
        y: cy + r * Math.sin(i * angleStep - Math.PI / 2)
      };
    });
  }

  // Smooth transition helper for attributes
  function animateAttr(el, attr, to, duration = 400) {
    const from = parseFloat(el.getAttribute(attr)) || 0;
    const diff = to - from;
    const start = performance.now();

    function step(ts) {
      const elapsed = ts - start;
      if (elapsed < duration) {
        const val = from + (diff * (elapsed / duration));
        el.setAttribute(attr, val);
        requestAnimationFrame(step);
      } else {
        el.setAttribute(attr, to);
      }
    }
    requestAnimationFrame(step);
  }

  // Render graph nodes and links
  function renderGraph() {
    if(!svg) createSVG();

    svg.innerHTML = ''; // clear old

    const positions = getNodePositions();

    // Draw links with smooth transitions
    links.forEach(link => {
      const source = positions.find(n => n.id === link.source);
      const target = positions.find(n => n.id === link.target);

      if(!source || !target) return;

      const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
      line.setAttribute('x1', source.x);
      line.setAttribute('y1', source.y);
      line.setAttribute('x2', source.x); // start same as x1 for animation
      line.setAttribute('y2', source.y);
      line.setAttribute('stroke', 'var(--fade)');
      line.setAttribute('stroke-width', '2');
      line.setAttribute('stroke-opacity', '0.5');
      svg.appendChild(line);

      // Animate line draw from source to target
      animateAttr(line, 'x2', target.x, 600);
      animateAttr(line, 'y2', target.y, 600);
    });

    // Draw nodes
    positions.forEach(node => {
      const g = document.createElementNS("http://www.w3.org/2000/svg", "g");
      g.style.cursor = 'pointer';

      // Circle
      const circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
      circle.setAttribute('cx', node.x);
      circle.setAttribute('cy', node.y);
      circle.setAttribute('r', nodeRadius);
      circle.setAttribute('fill', 'var(--card)');
      circle.setAttribute('stroke', getSectorColor(node.sector));
      circle.setAttribute('stroke-width', node.highlighted ? 6 : 3);
      circle.style.filter = node.highlighted ? 'drop-shadow(0 0 8px var(--highlight))' : 'none';
      circle.style.transition = 'stroke-width 0.3s ease, filter 0.3s ease';
      g.appendChild(circle);

      // Text
      const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
      text.setAttribute('x', node.x);
      text.setAttribute('y', node.y + 5);
      text.setAttribute('fill', 'var(--accent)');
      text.setAttribute('font-family', "'Orbitron', monospace");
      text.setAttribute('font-size', '11');
      text.setAttribute('text-anchor', 'middle');
      text.textContent = node.name;
      text.style.userSelect = 'none';
      g.appendChild(text);

      // Events: show tooltip on hover
      g.addEventListener('mouseenter', e => {
        showTooltip(e, node.name);
      });
      g.addEventListener('mouseleave', e => {
        hideTooltip();
      });

      // Click highlights node & related timeline cards
      g.addEventListener('click', () => {
        clearHighlights();
        node.highlighted = true;
        renderGraph();

        // Highlight timeline cards related to this node
        highlightTimelineCardsByNode(node.id);
      });

      svg.appendChild(g);
    });
  }

  // Get color var for sector
  function getSectorColor(sector) {
    switch(sector) {
      case 'tech': return 'var(--tech)';
      case 'politics': return 'var(--politics)';
      case 'crime': return 'var(--crime)';
      case 'finance': return 'var(--finance)';
      case 'influencer': return 'var(--influencer)';
      case 'surveillance': return 'var(--surveillance)';
      default: return 'var(--accent)';
    }
  }

  // Show tooltip at mouse pos
  function showTooltip(event, text) {
    tooltip.textContent = text;
    tooltip.style.opacity = 1;
    positionTooltip(event);
  }

  // Hide tooltip
  function hideTooltip() {
    tooltip.style.opacity = 0;
  }

  // Position tooltip near cursor
  function positionTooltip(event) {
    const padding = 15;
    let x = event.clientX + padding;
    let y = event.clientY + padding;
    const tooltipRect = tooltip.getBoundingClientRect();

    // Prevent overflow right
    if (x + tooltipRect.width > window.innerWidth) {
      x = event.clientX - tooltipRect.width - padding;
    }
    // Prevent overflow bottom
    if (y + tooltipRect.height > window.innerHeight) {
      y = event.clientY - tooltipRect.height - padding;
    }
    tooltip.style.left = x + 'px';
    tooltip.style.top = y + 'px';
  }

  // Highlight timeline cards related to a node id
  function highlightTimelineCardsByNode(nodeId) {
    // Find all event IDs related to this node
    const relatedEvents = Object.entries(eventToNodesMap)
      .filter(([evId, nodeIds]) => nodeIds.includes(nodeId))
      .map(([evId]) => evId);

    // Highlight matching cards
    document.querySelectorAll('.event').forEach(card => {
      if(relatedEvents.includes(card.dataset.id)) {
        card.classList.add('highlight');
      } else {
        card.classList.remove('highlight');
      }
    });
  }

  // Search functionality
  searchInput.addEventListener('input', e => {
    const query = e.target.value;
    filterTimeline(query);
  });

  clearSearchBtn.addEventListener('click', () => {
    searchInput.value = '';
    filterTimeline('');
  });

  // Dark mode toggle
  darkToggleBtn.addEventListener('click', () => {
    if(bodyEl.classList.contains('light')) {
      bodyEl.classList.remove('light');
      darkToggleBtn.textContent = 'Dark Mode';
    } else {
      bodyEl.classList.add('light');
      darkToggleBtn.textContent = 'Light Mode';
    }
  });

  // On window resize, re-render graph to adjust sizes
  window.addEventListener('resize', () => {
    renderGraph();
  });

  // Initial render
  renderTimeline(events);
  renderGraph();
})();
</script>
</body>
</html>
