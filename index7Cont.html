<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>TRON World Map - CSS Continent Sketch</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet" />

  <style>
    body {
      margin: 0;
      font-family: 'Orbitron', sans-serif;
      background: radial-gradient(circle at center, #000010 0%, #000000 100%);
      color: #00fff7;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
      padding: 20px 0 40px;
      overflow-x: hidden;
    }

    .alert-banner {
      background: linear-gradient(90deg, #ff004c, #ff0088, #ff004c);
      color: #fff;
      text-align: center;
      padding: 15px;
      font-weight: bold;
      text-shadow: 0 0 10px #000;
      animation: alert-pulse 1.5s infinite;
      width: 960px;
      margin-bottom: 30px;
      border-radius: 8px;
      transition: opacity 0.5s ease;
    }

    .alert-banner.hidden {
      opacity: 0;
      pointer-events: none;
      height: 0;
      padding: 0;
      margin-bottom: 0;
      animation: none;
    }

    @keyframes alert-pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    .map-container {
      width: 960px;
      height: 720px;
      position: relative;
      background: radial-gradient(ellipse at center, #001018 0%, #000 100%);
      border: 4px solid #00fff7;
      border-radius: 12px;
      box-shadow: 0 0 30px #00fff7, inset 0 0 20px #00fff7;
      margin-bottom: 40px;
      overflow: hidden;
    }

    .continent {
      position: absolute;
      background-color: rgba(0, 255, 247, 0.12);
      border: 2px dashed #00fff7;
      border-radius: 20%;
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { box-shadow: 0 0 10px rgba(0,255,247,0.5); }
      50% { box-shadow: 0 0 20px rgba(0,255,247,1); }
    }

    .africa        { top: 340px; left: 440px; width: 120px; height: 180px; }
    .antarctica    { top: 620px; left: 360px; width: 240px; height: 60px; }
    .asia          { top: 160px; left: 580px; width: 200px; height: 200px; }
    .europe        { top: 150px; left: 480px; width: 100px; height: 100px; }
    .north-america { top: 100px; left: 180px; width: 180px; height: 200px; }
    .south-america { top: 350px; left: 280px; width: 100px; height: 160px; }
    .oceania       { top: 460px; left: 720px; width: 100px; height: 100px; }

    .map-point {
      position: absolute;
      width: 24px;
      height: 24px;
      border-radius: 50%;
      border: 2px solid #00fff7;
      background-color: rgba(0, 255, 247, 0.6);
      box-shadow: 0 0 10px #00fff7;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      color: #00fff7;
      font-weight: bold;
      transition: transform 0.2s ease, background-color 0.2s ease;
    }

    .map-point:hover,
    .map-point:focus {
      background-color: #00fff7;
      color: #000;
      transform: scale(1.3);
      z-index: 10;
    }

    .map-point.active {
      background-color: #ff00ff;
      color: #fff;
      transform: scale(1.4);
      box-shadow: 0 0 20px #ff00ff;
      z-index: 20;
    }

    .cards-container {
      width: 960px;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 20px;
      justify-items: center;
    }

    .card-link {
      text-decoration: none;
      color: inherit;
      display: block;
    }

    .card {
      width: 150px;
      height: 190px;
      perspective: 1000px;
      cursor: pointer;
    }

    .card-inner {
      width: 100%;
      height: 100%;
      transition: transform 0.8s ease;
      transform-style: preserve-3d;
      position: relative;
    }

    .card:hover .card-inner,
    .card:focus .card-inner,
    .card.active .card-inner {
      transform: rotateY(180deg);
    }

    .card-front,
    .card-back {
      position: absolute;
      width: 100%;
      height: 100%;
      backface-visibility: hidden;
      border: 2px solid;
      border-image: linear-gradient(45deg, #00fff7, #ff00ff, #00ffae, #00fff7) 1;
      border-radius: 12px;
      background: rgba(0, 0, 20, 0.9);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      box-shadow: 0 0 20px #00fff7;
      color: #00fff7;
      text-align: center;
      padding: 12px;
      font-size: 0.9rem;
    }

    .card-back {
      transform: rotateY(180deg);
    }

    /* üîÑ Horizontal karma bar styles */
    .karma-bar {
      margin-top: 10px;
      width: 100%;
      height: 18px;
      border: 1px solid #fff;
      border-radius: 8px;
      background-color: #111;
      overflow: hidden;
      position: relative;
      box-shadow: inset 0 0 6px #00fff7;
      font-size: 12px;
      color: #000;
      text-shadow: none;
    }

    .karma-fill {
      background: linear-gradient(to right, #00ff00, #ffff00, #ff0000);
      height: 100%;
      width: 0;
      transition: width 1s ease-in-out;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      color: #000;
      user-select: none;
    }

    /* Optional: change text color for better contrast on wider bars */
    .karma-fill.wide {
      color: #fff;
      text-shadow: 0 0 4px #000;
    }
  </style>
</head>
<body>

  <div class="alert-banner">‚ö†Ô∏è HOLOGRAPHIC WARNING: High tectonic activity detected in the Pacific Plate‚Ä¶</div>

  <div class="map-container">
    <div class="continent africa"></div>
    <div class="continent antarctica"></div>
    <div class="continent asia"></div>
    <div class="continent europe"></div>
    <div class="continent north-america"></div>
    <div class="continent south-america"></div>
    <div class="continent oceania"></div>
  </div>

  <div class="cards-container"></div>

  <audio id="hoverSound" src="https://assets.mixkit.co/sfx/preview/mixkit-technology-interface-click-1127.mp3" preload="auto"></audio>

  <script>
    const continents = [
      { name: 'Africa',        emoji: 'üåç', element: 'Earth', sign: 'Taurus',      age: 'Ancient',    energy: 'Grounded',    karma: 75, href: '#', top: 420, left: 480 },
      { name: 'Antarctica',    emoji: '‚ùÑÔ∏è', element: 'Water', sign: 'Capricorn',   age: 'Pristine',   energy: 'Calm',        karma: 50, href: '#', top: 640, left: 460 },
      { name: 'Asia',          emoji: 'üåè', element: 'Fire',  sign: 'Aries',       age: 'Ancient',    energy: 'Dynamic',     karma: 90, href: '#', top: 230, left: 660 },
      { name: 'Europe',        emoji: 'üåç', element: 'Air',   sign: 'Gemini',      age: 'Historic',   energy: 'Intellectual',karma: 65, href: '#', top: 180, left: 530 },
      { name: 'North America', emoji: 'üåé', element: 'Air',   sign: 'Libra',       age: 'Modern',     energy: 'Balanced',    karma: 80, href: '#', top: 140, left: 250 },
      { name: 'South America', emoji: 'üåé', element: 'Fire',  sign: 'Sagittarius', age: 'Lush',       energy: 'Passionate',  karma: 70, href: '#', top: 400, left: 320 },
      { name: 'Oceania',       emoji: 'üåä', element: 'Water', sign: 'Pisces',      age: 'Ancient',    energy: 'Spiritual',   karma: 55, href: '#', top: 500, left: 760 },
    ];

    const map = document.querySelector('.map-container');
    const cards = document.querySelector('.cards-container');
    const hoverSound = document.getElementById('hoverSound');
    const alertBanner = document.querySelector('.alert-banner');

    function playSound() {
      hoverSound.currentTime = 0;
      hoverSound.play().catch(() => {});
    }

    continents.forEach((c, i) => {
      // Create map point
      const point = document.createElement('button');
      point.className = 'map-point';
      point.style.top = c.top + 'px';
      point.style.left = c.left + 'px';
      point.innerText = c.emoji;
      point.dataset.index = i;

      point.addEventListener('click', () => highlight(i));
      point.addEventListener('mouseenter', playSound);
      map.appendChild(point);

      // Create card link and card elements
      const cardLink = document.createElement('a');
      cardLink.href = c.href;
      cardLink.className = 'card-link';

      const card = document.createElement('div');
      card.className = 'card';
      card.dataset.index = i;

      const cardInner = document.createElement('div');
      cardInner.className = 'card-inner';

      // Front side of the card with karma bar (karma-fill starts width=0)
      const front = document.createElement('div');
      front.className = 'card-front';
      front.innerHTML = `
        <h4>${c.emoji} ${c.name}</h4>
        <div>Element: ${c.element}</div>
        <div>Sign: ${c.sign}</div>
        <div>Age: ${c.age}</div>
        <div>Energy: ${c.energy}</div>
        <div class="karma-bar" title="Karma Level: ${c.karma}%">
          <div class="karma-fill">0%</div>
        </div>`;

      const back = document.createElement('div');
      back.className = 'card-back';
      back.innerHTML = `<h5>Birth Chart</h5><div class="birth-chart">[Astrological Info]</div>`;

      cardInner.append(front, back);
      card.append(cardInner);
      cardLink.append(card);
      cards.append(cardLink);

      card.addEventListener('click', () => {
        card.classList.toggle('active');
        playSound();
      });
    });

    function highlight(i) {
      document.querySelectorAll('.card').forEach(card => card.classList.remove('active'));
      document.querySelectorAll('.map-point').forEach(p => p.classList.remove('active'));

      const selectedCard = document.querySelector(`.card[data-index="${i}"]`);
      const selectedPoint = document.querySelector(`.map-point[data-index="${i}"]`);

      selectedCard.classList.add('active');
      selectedPoint.classList.add('active');
      selectedCard.scrollIntoView({ behavior: 'smooth', block: 'center' });
      playSound();
    }

    // Animate karma bars from 0 to actual karma %
    setTimeout(() => {
      document.querySelectorAll('.karma-fill').forEach((fill, index) => {
        const value = continents[index].karma;
        fill.style.width = value + '%';
        fill.textContent = value + '%';

        // Add class for wide fills for text color contrast
        if (value > 50) {
          fill.classList.add('wide');
        } else {
          fill.classList.remove('wide');
        }
      });
    }, 100);

    // *** USGS Earthquake Data Fetch and Update Alert Banner ***

    // Pacific Plate bounding box roughly from your extent: 
    // extent=21.28937,-129.99023&extent=52.26816,-60.0293
    // which means lat from 21.28 to 52.26 and lon from -129.99 to -60.03 (roughly W Coast USA and Pacific area)

    // We'll fetch earthquakes from last 24 hours, min magnitude 4.5
    const USGS_API_URL = 'https://earthquake.usgs.gov/fdsnws/event/1/query?format=geojson&starttime=';

    function fetchEarthquakeData() {
      const now = new Date();
      const yesterday = new Date(now.getTime() - 24*60*60*1000);
      const starttime = yesterday.toISOString();

      // Query params:
      // minlatitude=21.28, maxlatitude=52.26, minlongitude=-129.99, maxlongitude=-60.03
      // minmagnitude=4.5
      // Order by time descending, limit 10

      const url = `${USGS_API_URL}${starttime}&minlatitude=21.28&maxlatitude=52.26&minlongitude=-129.99&maxlongitude=-60.03&minmagnitude=4.5&orderby=time&limit=10`;

      fetch(url)
        .then(res => res.json())
        .then(data => {
          if (data.features && data.features.length > 0) {
            // We have recent quakes, build a summary string
            const quakes = data.features;

            // Build message: e.g. "3 quakes >4.5 in last 24h. Largest M6.1 at California, CA, 2h ago."
            const count = quakes.length;

            // Find largest quake
            let largest = quakes[0];
            quakes.forEach(q => {
              if (q.properties.mag > largest.properties.mag) largest = q;
            });

            // Format location from place property, truncated if too long
            let place = largest.properties.place || 'Unknown location';
            if (place.length > 40) place = place.slice(0, 37) + '...';

            // Calculate time ago
            const quakeTime = new Date(largest.properties.time);
            const diffMs = now - quakeTime;
            const diffHours = Math.floor(diffMs / (1000*60*60));
            let timeAgo = diffHours > 0 ? `${diffHours} hour${diffHours > 1 ? 's' : ''} ago` : 'just now';

            alertBanner.textContent = `‚ö†Ô∏è HOLOGRAPHIC WARNING: ${count} earthquake${count > 1 ? 's' : ''} >4.5 detected in the Pacific Plate in the last 24h. Largest M${largest.properties.mag.toFixed(1)} at ${place}, ${timeAgo}.`;
            alertBanner.classList.remove('hidden');
          } else {
            // No significant quakes
            alertBanner.textContent = '‚úÖ No significant tectonic activity detected in the Pacific Plate in the last 24 hours.';
            alertBanner.classList.remove('hidden');
            alertBanner.style.background = 'linear-gradient(90deg, #008800, #00cc00, #008800)';
            alertBanner.style.textShadow = '0 0 8px #004400';
            alertBanner.style.animation = 'none';
          }
        })
        .catch(err => {
          console.error('Error fetching earthquake data:', err);
          alertBanner.textContent = '‚ö†Ô∏è HOLOGRAPHIC WARNING: Unable to retrieve tectonic activity data.';
          alertBanner.classList.remove('hidden');
          alertBanner.style.background = 'linear-gradient(90deg, #ff004c, #ff0088, #ff004c)';
          alertBanner.style.textShadow = '0 0 10px #000';
          alertBanner.style.animation = 'alert-pulse 1.5s infinite';
        });
    }

    fetchEarthquakeData();

    // Optional: refresh alert every 10 minutes
    setInterval(fetchEarthquakeData, 10 * 60 * 1000);
  </script>

  <script>
  const alertBanner = document.querySelector('.alert-banner');

  // USGS Earthquake API for Pacific Plate region
  // Bounds roughly cover Pacific Plate: [minLat, minLon, maxLat, maxLon]
  const usgsUrl = 'https://earthquake.usgs.gov/fdsnws/event/1/query?format=geojson&starttime=' + 
                  new Date(new Date().getTime() - 6 * 60 * 60 * 1000).toISOString() + // last 6 hours
                  '&minmagnitude=5.0&minlatitude=21.28937&maxlatitude=52.26816&minlongitude=-129.99023&maxlongitude=-60.0293';

  // NOAA Tsunami Warning API (latest alerts)
  const tsunamiUrl = 'https://api.tsunami.gov/alerts/v1/list'; // This endpoint might need CORS proxy or alternative if blocked

  async function checkAlerts() {
    let earthquakeAlert = false;
    let tsunamiAlert = false;
    let messages = [];

    try {
      // Fetch Earthquake data
      const eqResponse = await fetch(usgsUrl);
      const eqData = await eqResponse.json();

      if (eqData.features && eqData.features.length > 0) {
        earthquakeAlert = true;
        const mag = eqData.features[0].properties.mag;
        const place = eqData.features[0].properties.place;
        messages.push(`‚ö†Ô∏è HOLOGRAPHIC WARNING: High tectonic activity detected! Recent earthquake (M${mag}) near ${place}.`);
      }
    } catch (e) {
      console.warn('Failed to fetch earthquake data:', e);
    }

    try {
      // Fetch Tsunami alerts
      // NOTE: NOAA tsunami API may have CORS restrictions. You may need a proxy or backend for real production.
      const tsResponse = await fetch(tsunamiUrl);
      const tsData = await tsResponse.json();

      if (tsData.alerts && tsData.alerts.length > 0) {
        // Filter tsunami alerts related to Pacific region or global alerts
        const activeTsunamis = tsData.alerts.filter(alert => 
          alert.status === 'Actual' && 
          (alert.eventType === 'Tsunami' || alert.eventType === 'Tsunami Warning')
        );

        if (activeTsunamis.length > 0) {
          tsunamiAlert = true;
          messages.push(`üåä TSUNAMI ALERT: ${activeTsunamis[0].eventDescription || 'Tsunami warning in effect!'}`);
        }
      }
    } catch (e) {
      console.warn('Failed to fetch tsunami data:', e);
    }

    // Update alert banner or hide if no alert
    if (earthquakeAlert || tsunamiAlert) {
      alertBanner.innerHTML = messages.join('<br>');
      alertBanner.style.display = 'block';
    } else {
      alertBanner.style.display = 'none';  // hide if no alerts
    }
  }

  // Run check immediately, then every 5 minutes
  checkAlerts();
  setInterval(checkAlerts, 5 * 60 * 1000);
</script>
</body>
</html>
