<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Crime Boss Arrested Yearbook (2001–2025)</title>

  <!-- Leaflet CSS -->
  <link 
    rel="stylesheet" 
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" 
    crossorigin=""
  />

  <!-- Leaflet MarkerCluster CSS -->
  <link 
    rel="stylesheet" 
    href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css" 
  />
  <link 
    rel="stylesheet" 
    href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css" 
  />

  <style>
    body { font-family: Arial, sans-serif; background: #f4f4f4; padding: 2rem; color: #333; }
    h1 { margin-bottom: 1rem; }
    #map { height: 350px; border-radius: 8px; margin-bottom: 2rem; }
    #charts { display: flex; gap: 2rem; margin-bottom: 2rem; flex-wrap: wrap; }
    canvas { background: white; border-radius: 8px; padding: 1rem; box-shadow: 0 0 8px rgba(0,0,0,0.1); }

    /* Collapsible Panels */
    .boss-card {
      background: white;
      border-left: 10px solid #aaa;
      margin-bottom: 1rem;
      border-radius: 6px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      cursor: pointer;
      transition: background 0.3s;
      overflow: hidden;
    }
    .boss-header {
      padding: 1rem 1.5rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-weight: bold;
      font-size: 1.1rem;
      user-select: none;
    }
    .boss-header:hover { background: #eee; }
    .boss-body {
      padding: 0 1.5rem 1rem 1.5rem;
      display: none;
      font-size: 0.9rem;
      color: #444;
    }
    .boss-card.active .boss-body {
      display: block;
    }
    .boss-card.active {
      border-left-width: 15px;
      background: #fafafa;
    }
    .year { color: #666; font-size: 0.85rem; }
    .labels {
      margin: 0.5rem 0;
    }
    .label {
      display: inline-block;
      padding: 0.2rem 0.5rem;
      margin-right: 0.5rem;
      font-size: 0.8rem;
      font-weight: bold;
      color: white;
      border-radius: 4px;
      user-select: none;
    }

    /* Chakra color codes for regions/themes */
    /* Root (red) */
    .root { background: #b22222; }          /* Kingpin, Druglord */
    /* Sacral (orange) */
    .sacral { background: #ff8c00; }        /* Fugitive, racketeer */
    /* Solar Plexus (yellow) */
    .solar { background: #ffd700; color: #333; }   /* Human trafficking */
    /* Heart (green) */
    .heart { background: #228b22; }          /* Drug trafficking */
    /* Throat (blue) */
    .throat { background: #1e90ff; }          /* Asia */
    /* Third Eye (indigo) */
    .third-eye { background: #4b0082; }       /* Eurasia */
    /* Crown (violet) */
    .crown { background: #8a2be2; }           /* Mafia, Europe */

    /* Highlight selected boss */
    .boss-card.highlight {
      border-left-color: #ff4081 !important;
      background: #fff0f6;
      box-shadow: 0 0 15px 2px #ff4081;
      z-index: 999;
      position: relative;
    }
  </style>
</head>
<body>

  <h1>Crime Boss Arrested Yearbook (2001–2025)</h1>

  <div id="map"></div>

  <div id="charts">
    <canvas id="yearChart" width="400" height="250"></canvas>
    <canvas id="regionChart" width="400" height="250"></canvas>
  </div>

  <input 
    type="text" 
    id="searchBox" 
    placeholder="Filter by region or theme..." 
    style="padding:0.5rem; width:100%; margin-bottom:1rem;" 
  />

  <div id="bossContainer">
    <!-- Boss cards are generated dynamically -->
  </div>

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>
  <!-- Leaflet MarkerCluster -->
  <script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>
  <!-- Leaflet Heatmap -->
  <script src="https://leaflet.github.io/Leaflet.heat/dist/leaflet-heat.js"></script>
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <script>
    // DATA for bosses including chakra-based color categories, coords, arrest year, region
    const bosses = [
      {
        id: 'erick',
        name: 'Érick Valencia Salazar (“El 85”) – CJNG',
        coords: [19.4326, -99.1332], // Mexico City
        year: 2025,
        region: 'Latin America',
        themes: ['root', 'heart'], // Kingpin, Drug trafficking
        description: `Cartel (Mexico) - Arrested 2012, Extradited 2025`
      },
      {
        id: 'alvin',
        name: 'Alvin Chau – Macau Junket Boss',
        coords: [22.1987, 113.5439], // Macau
        year: 2023,
        region: 'Asia',
        themes: ['throat', 'sacral'], // Asia, racketeer
        description: `Asia (Macau) - Arrested 2021, Sentenced 2023`
      },
      {
        id: 'she',
        name: 'She Zhijiang – Chinese Cambodian Crime Boss',
        coords: [13.3614, 103.8600], // Phnom Penh, Cambodia
        year: 2022,
        region: 'Asia',
        themes: ['solar'], // Human trafficking
        description: `Asia (SE Asia) - Charged 2014, Captured 2022`
      },
      {
        id: 'ismael',
        name: 'Ismael “El Mayo” Zambada – Sinaloa Cartel',
        coords: [31.7619, -106.4850], // El Paso, TX approx.
        year: 2024,
        region: 'Latin America',
        themes: ['root', 'heart'], // Kingpin, Drug trafficking
        description: `Cartel (Mexico) - Captured 2024, Pleaded guilty 2025`
      }
    ];

    const chakraColors = {
      root: '#b22222',
      sacral: '#ff8c00',
      solar: '#ffd700',
      heart: '#228b22',
      throat: '#1e90ff',
      'third-eye': '#4b0082',
      crown: '#8a2be2'
    };

    // 1. Generate boss cards dynamically
    const bossContainer = document.getElementById('bossContainer');

    bosses.forEach(boss => {
      // Compose labels
      const labelSpans = boss.themes.map(theme => 
        `<span class="label ${theme}" style="background:${chakraColors[theme]}">${theme.charAt(0).toUpperCase() + theme.slice(1)}</span>`
      ).join(' ');

      const card = document.createElement('div');
      card.className = 'boss-card';
      card.id = `boss-${boss.id}`;
      card.dataset.tags = boss.region.toLowerCase() + ' ' + boss.themes.join(' ');
      card.innerHTML = `
        <div class="boss-header">
          <span>${boss.name}</span>
          <span class="year">${boss.year}</span>
        </div>
        <div class="labels">${labelSpans}</div>
        <div class="boss-body">${boss.description}</div>
      `;

      bossContainer.appendChild(card);
    });

    // 2. Collapsible panels functionality
    document.querySelectorAll('.boss-card .boss-header').forEach(header => {
      header.addEventListener('click', () => {
        const card = header.parentElement;
        card.classList.toggle('active');
      });
    });

    // 3. Initialize Leaflet map with clustering & heatmap
    const map = L.map('map').setView([20, 0], 2);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    // Marker cluster group
    const markers = L.markerClusterGroup();

    // Collect points for heatmap: [lat, lng, intensity]
    // Intensity = number of arrests from that region (just 1 here, but we can count)
    const heatPoints = [];

    bosses.forEach(boss => {
      const marker = L.circleMarker(boss.coords, {
        radius: 10,
        fillColor: chakraColors[boss.themes[0]] || '#000',
        color: '#333',
        weight: 1,
        opacity: 1,
        fillOpacity: 0.8
      });

      marker.bindPopup(`<strong>${boss.name}</strong><br>${boss.description}`);

      // When marker clicked, highlight card
      marker.on('click', () => {
        document.querySelectorAll('.boss-card').forEach(c => c.classList.remove('highlight'));
        const card = document.getElementById(`boss-${boss.id}`);
        card.classList.add('highlight');
        card.scrollIntoView({behavior: "smooth", block: "center"});
        // Also open the card details (collapse)
        card.classList.add('active');
      });

      markers.addLayer(marker);

      heatPoints.push([...boss.coords, 0.7]); // intensity 0.7 for example
    });

    map.addLayer(markers);

    // Add heatmap layer
    const heat = L.heatLayer(heatPoints, {radius: 30, blur: 20, maxZoom: 7});
    heat.addTo(map);

    // 4. Charts: arrests by year & region using Chart.js

    // Count arrests per year
    const arrestsByYear = {};
    bosses.forEach(b => {
      arrestsByYear[b.year] = (arrestsByYear[b.year] || 0) + 1;
    });

    // Count arrests per region
    const arrestsByRegion = {};
    bosses.forEach(b => {
      arrestsByRegion[b.region] = (arrestsByRegion[b.region] || 0) + 1;
    });

    const yearCtx = document.getElementById('yearChart').getContext('2d');
    const regionCtx = document.getElementById('regionChart').getContext('2d');

    const yearChart = new Chart(yearCtx, {
      type: 'bar',
      data: {
        labels: Object.keys(arrestsByYear).sort(),
        datasets: [{
          label: 'Arrests per Year',
          data: Object.keys(arrestsByYear).sort().map(y => arrestsByYear[y]),
          backgroundColor: 'rgba(178, 34, 34, 0.7)',
          borderColor: 'rgba(178, 34, 34, 1)',
          borderWidth: 1
        }]
      },
      options: {
        scales: {
          y: { beginAtZero: true, stepSize: 1 },
          x: { title: { display: true, text: 'Year' } }
        }
      }
    });

    const regionChart = new Chart(regionCtx, {
      type: 'doughnut',
      data: {
        labels: Object.keys(arrestsByRegion),
        datasets: [{
          label: 'Arrests by Region',
          data: Object.values(arrestsByRegion),
          backgroundColor: [
            chakraColors.root,
            chakraColors.throat,
            chakraColors.solar,
            chakraColors.heart,
            chakraColors.crown,
            chakraColors.sacral,
            chakraColors['third-eye']
          ].slice(0, Object.keys(arrestsByRegion).length),
          borderWidth: 1
        }]
      },
      options: {
        responsive: true,
        plugins: {
          legend: { position: 'bottom' }
        }
      }
    });

    // 5. Search filter
    const searchBox = document.getElementById('searchBox');
    const cards = document.querySelectorAll('.boss-card');
    searchBox.addEventListener('input', () => {
      const filter = searchBox.value.toLowerCase();
      cards.forEach(card => {
        const tags = card.dataset.tags.toLowerCase();
        card.style.display = tags.includes(filter) ? '' : 'none';
      });
    });

  </script>
</body>
</html>
