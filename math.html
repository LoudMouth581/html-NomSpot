<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Carnival Accounting Teeth Shooting Game</title>
  <style>
    body, html {
      margin: 0; padding: 0; height: 100%;
      background: radial-gradient(circle at center, #191919, #000);
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      color: #0ff;
      overflow: hidden;
      user-select: none;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    #game {
      width: 100vw;
      max-width: 480px;
      height: 100vh;
      display: flex;
      flex-direction: column;
      background: #101622;
      box-shadow: 0 0 30px #0ff inset;
      position: relative;
    }
    /* Score and Timer bar */
    #header {
      display: flex;
      justify-content: space-between;
      padding: 14px 20px;
      font-weight: 700;
      font-size: 1.2rem;
      border-bottom: 2px solid #0ff;
      user-select: none;
    }
    #score, #timer {
      color: #0ff;
    }

    /* Family Feud style question and answers container */
    #question-container {
      margin: 12px 16px;
      background: #022;
      border-radius: 10px;
      box-shadow: 0 0 15px #0ff inset;
      padding: 12px;
      display: flex;
      flex-direction: column;
      align-items: center;
      user-select: none;
    }
    #question-text {
      font-weight: 900;
      font-size: 1.8rem;
      margin-bottom: 14px;
      color: #0ff;
      text-align: center;
      text-shadow: 0 0 12px #0ff;
    }

    /* Teeth answers flex row */
    #answers-row {
      display: flex;
      justify-content: space-around;
      width: 100%;
      max-width: 440px;
      gap: 12px;
    }
    .tooth {
      background: linear-gradient(135deg, #7ef9ff, #00fff7);
      width: 60px;
      height: 80px;
      border-radius: 0 0 30px 30px;
      position: relative;
      box-shadow: 0 0 15px #00fff7;
      display: flex;
      justify-content: center;
      align-items: center;
      font-weight: 800;
      font-size: 1.3rem;
      color: #00444d;
      text-shadow: 0 0 8px #00fff7;
      cursor: default;
      user-select: none;
      /* Teeth top “root” shape */
      clip-path: polygon(
        0% 20%, 15% 0%, 85% 0%, 100% 20%, 100% 100%, 0% 100%
      );
      transition: transform 0.2s ease;
    }
    .tooth.pop-correct {
      background: #0f0;
      box-shadow: 0 0 20px #0f0;
      transform: scale(1.3) translateY(-10px);
      transition: transform 0.3s ease, background 0.3s ease;
    }
    .tooth.pop-wrong {
      background: #f33;
      box-shadow: 0 0 20px #f33;
      transform: scale(1.1) translateY(-5px);
      transition: transform 0.3s ease, background 0.3s ease;
    }

    /* Clown face container */
    #clown-container {
      position: relative;
      height: 300px;
      margin-top: 20px;
      display: flex;
      justify-content: center;
      align-items: flex-end;
      user-select: none;
    }

    /* Clown face base */
    #clown-face {
      width: 240px;
      height: 240px;
      background: radial-gradient(circle at center, #f0c, #a00);
      border-radius: 50%;
      position: relative;
      box-shadow: 0 0 40px #f0c inset;
    }

    /* Clown eyes */
    .eye {
      position: absolute;
      top: 80px;
      width: 40px;
      height: 40px;
      background: #fff;
      border-radius: 50%;
      box-shadow: inset 0 0 8px #000;
    }
    .eye.left {
      left: 55px;
    }
    .eye.right {
      right: 55px;
    }
    .pupil {
      position: absolute;
      top: 12px;
      left: 12px;
      width: 16px;
      height: 16px;
      background: #000;
      border-radius: 50%;
    }

    /* Clown nose */
    #nose {
      position: absolute;
      top: 130px;
      left: 50%;
      transform: translateX(-50%);
      width: 40px;
      height: 40px;
      background: #ff3c3c;
      border-radius: 50%;
      box-shadow: 0 0 15px #f33 inset;
    }

    /* Teeth holder above clown mouth */
    #teeth-holder {
      position: absolute;
      bottom: 40px;
      left: 50%;
      transform: translateX(-50%);
      width: 260px;
      height: 90px;
      display: flex;
      justify-content: space-between;
      gap: 14px;
      pointer-events: none;
    }
    /* Each tooth on clown */
    .clown-tooth {
      width: 40px;
      height: 70px;
      background: linear-gradient(135deg, #fff, #ccc);
      border-radius: 0 0 20px 20px;
      clip-path: polygon(
        0% 20%, 20% 0%, 80% 0%, 100% 20%, 100% 100%, 0% 100%
      );
      box-shadow: 0 0 8px #999 inset;
      position: relative;
      pointer-events: auto;
      cursor: pointer;
      transition: background 0.3s ease, transform 0.3s ease;
      display: flex;
      justify-content: center;
      align-items: center;
      font-weight: 700;
      font-size: 1.1rem;
      color: #222;
      user-select: none;
      text-shadow: none;
    }
    .clown-tooth:hover {
      background: #fefefe;
      transform: translateY(-6px);
      box-shadow: 0 0 20px #0ff;
    }
    .clown-tooth.pop-correct {
      background: #0f0;
      box-shadow: 0 0 25px #0f0;
      transform: scale(1.3) translateY(-10px);
    }
    .clown-tooth.pop-wrong {
      background: #f33;
      box-shadow: 0 0 25px #f33;
      transform: scale(1.1) translateY(-5px);
    }

    /* Shooter at bottom center */
    #shooter {
      position: absolute;
      bottom: 14px;
      left: 50%;
      transform: translateX(-50%);
      width: 60px;
      height: 90px;
      background: linear-gradient(135deg, #0ff, #00bbcc);
      clip-path: polygon(50% 0%, 80% 100%, 20% 100%);
      box-shadow: 0 0 14px #0ff;
      user-select: none;
    }

    /* Dart */
    .dart {
      position: absolute;
      width: 6px;
      height: 30px;
      background: #0ff;
      border-radius: 3px;
      box-shadow: 0 0 12px #0ff;
      pointer-events: none;
      user-select: none;
      z-index: 10;
    }

    /* Feedback text */
    #feedback {
      margin: 10px auto 8px;
      font-weight: 700;
      font-size: 1.3rem;
      height: 32px;
      text-align: center;
      user-select: none;
      color: #0ff;
      text-shadow: 0 0 12px #0ff;
      min-height: 32px;
    }

    /* Start button */
    #startBtn {
      margin: 8px auto 16px;
      padding: 14px 26px;
      font-weight: 700;
      font-size: 1.2rem;
      background: #0ff;
      border: none;
      border-radius: 20px;
      cursor: pointer;
      color: #00444d;
      box-shadow: 0 0 20px #0ff inset;
      transition: background 0.3s ease;
      user-select: none;
      max-width: 220px;
      display: block;
    }
    #startBtn:hover:not(:disabled) {
      background: #00ccc7;
    }
    #startBtn:disabled {
      background: #006666;
      cursor: not-allowed;
    }

    /* Responsive tweaks */
    @media (max-width: 400px) {
      #game {
        max-width: 100vw;
      }
      #question-text {
        font-size: 1.5rem;
      }
      #answers-row {
        gap: 8px;
      }
      .tooth {
        width: 50px;
        height: 70px;
        font-size: 1rem;
      }
      #clown-face {
        width: 200px;
        height: 200px;
      }
      #teeth-holder {
        width: 220px;
        gap: 10px;
      }
      .clown-tooth {
        width: 35px;
        height: 60px;
        font-size: 0.9rem;
      }
      #shooter {
        width: 50px;
        height: 75px;
      }
      .dart {
        width: 5px;
        height: 25px;
      }
    }
  </style>
</head>
<body>
  <div id="game">
    <div id="header">
      <div id="score">Score: 0</div>
      <div id="timer">Time: 60</div>
    </div>
    <div id="question-container" aria-live="polite">
      <div id="question-text">Press Start to Play!</div>
      <div id="answers-row"></div>
    </div>
    <div id="clown-container" aria-label="Carnival clown face with teeth targets">
      <div id="clown-face" aria-hidden="true">
        <div class="eye left"><div class="pupil"></div></div>
        <div class="eye right"><div class="pupil"></div></div>
        <div id="nose"></div>
      </div>
      <div id="teeth-holder" aria-live="polite" aria-atomic="true">
        <!-- Teeth will be dynamically inserted here -->
      </div>
    </div>
    <div id="feedback" aria-live="assertive" aria-atomic="true"></div>
    <button id="startBtn" aria-label="Start Game Button">Start Game</button>
    <div id="shooter" aria-label="Shooter, move left and right"></div>
  </div>

  <script>
    (() => {
      const scoreEl = document.getElementById('score');
      const timerEl = document.getElementById('timer');
      const questionText = document.getElementById('question-text');
      const answersRow = document.getElementById('answers-row');
      const teethHolder = document.getElementById('teeth-holder');
      const feedbackEl = document.getElementById('feedback');
      const startBtn = document.getElementById('startBtn');
      const shooter = document.getElementById('shooter');
      const game = document.getElementById('game');

      let score = 0;
      let timeLeft = 60;
      let timerInterval = null;
      let gameActive = false;

      let currentQuestion = null;
      let currentAnswer = null;

      let darts = [];

      // Utilities
      const randomInt = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;

      // Generate accounting addition question & answers
      function generateQA() {
        const maxNum = Math.min(15 + Math.floor(score / 3), 99);
        const a = randomInt(1, maxNum);
        const b = randomInt(1, maxNum);
        const correct = a + b;
        const question = `${a} + ${b} = ?`;
        const answersSet = new Set([correct]);

        while (answersSet.size < 6) {  // 6 answers total
          let candidate = correct + randomInt(-maxNum, maxNum);
          if (candidate < 0) candidate = 0;
          answersSet.add(candidate);
        }

        const answersArr = Array.from(answersSet);
        // Shuffle answers
        for (let i = answersArr.length - 1; i > 0; i--) {
          const j = randomInt(0, i);
          [answersArr[i], answersArr[j]] = [answersArr[j], answersArr[i]];
        }

        return { question, correct, answers: answersArr };
      }

      // Update score display
      function updateScore() {
        scoreEl.textContent = `Score: ${score}`;
      }

      // Start timer countdown
      function startTimer() {
        timeLeft = 60;
        timerEl.textContent = `Time: ${timeLeft}`;
        timerInterval = setInterval(() => {
          timeLeft--;
          timerEl.textContent = `Time: ${timeLeft}`;
          if (timeLeft <= 0) {
            endGame();
          }
        }, 1000);
      }

      // End game state
      function endGame() {
        gameActive = false;
        clearInterval(timerInterval);
        questionText.textContent = 'Game Over!';
        feedbackEl.textContent = `Your final score: ${score}`;
        clearTeeth();
        clearAnswersRow();
        darts.forEach(d => d.el.remove());
        darts = [];
        startBtn.disabled = false;
        startBtn.textContent = 'Restart Game';
      }

      // Clear teeth from clown mouth
      function clearTeeth() {
        while (teethHolder.firstChild) {
          teethHolder.removeChild(teethHolder.firstChild);
        }
      }
      // Clear answers from top row
      function clearAnswersRow() {
        while (answersRow.firstChild) {
          answersRow.removeChild(answersRow.firstChild);
        }
      }

      // Setup question and teeth answers
      function setupQuestion() {
        clearTeeth();
        clearAnswersRow();

        const qa = generateQA();
        currentQuestion = qa.question;
        currentAnswer = qa.correct;

        questionText.textContent = currentQuestion;

        // Top row answers (Family Feud style)
        qa.answers.forEach(answer => {
          const tooth = document.createElement('div');
          tooth.className = 'tooth';
          tooth.textContent = answer;
          answersRow.appendChild(tooth);
        });

        // Teeth on clown mouth
        qa.answers.forEach((answer, i) => {
          const tooth = document.createElement('div');
          tooth.className = 'clown-tooth';
          tooth.textContent = answer;
          tooth.dataset.value = answer;
          teethHolder.appendChild(tooth);
        });

        feedbackEl.textContent = 'Shoot the correct tooth!';

      }

      // Move shooter horizontally with arrow keys (or A/D)
      let shooterPos = 50; // percent left of game width
      const shooterSpeed = 5; // percent per keypress
      function updateShooter() {
        shooter.style.left = `${shooterPos}%`;
      }

      function moveShooterLeft() {
        shooterPos = Math.max(5, shooterPos - shooterSpeed);
        updateShooter();
      }
      function moveShooterRight() {
        shooterPos = Math.min(95, shooterPos + shooterSpeed);
        updateShooter();
      }

      // Shoot a dart
      function shootDart() {
        if (!gameActive) return;

        const dart = document.createElement('div');
        dart.className = 'dart';
        game.appendChild(dart);

        // Initial dart position
        // Calculate pixel left relative to game container
        const gameRect = game.getBoundingClientRect();
        const leftPx = (shooterPos / 100) * gameRect.width;
        const bottomPx = 110; // just above shooter approx

        dart.style.left = `${leftPx - 3}px`; // center dart (6px width)
        dart.style.bottom = `${bottomPx}px`;

        // Dart object with position and element
        const dartObj = {
          el: dart,
          x: leftPx,
          y: bottomPx,
          speed: 12, // px per frame approx
          active: true,
        };
        darts.push(dartObj);
      }

      // Detect collision between dart and teeth
      function detectCollision(dartObj) {
        const teeth = document.querySelectorAll('.clown-tooth');
        for (const tooth of teeth) {
          const rect = tooth.getBoundingClientRect();
          const gameRect = game.getBoundingClientRect();

          // Calculate tooth bounds relative to game container (dart is positioned absolute to game)
          const toothLeft = rect.left - gameRect.left;
          const toothRight = rect.right - gameRect.left;
          const toothTop = gameRect.height - (rect.bottom - gameRect.top);
          const toothBottom = gameRect.height - (rect.top - gameRect.top);

          // Dart bounds (dart.x is horizontal px pos, dart.y is vertical px pos from bottom)
          const dartLeft = dartObj.x - 3; // dart width 6px, center -3
          const dartRight = dartObj.x + 3;
          const dartTop = dartObj.y + 30; // dart height 30 px
          const dartBottom = dartObj.y;

          // Check overlapping horizontally and vertically (y axis is bottom-up)
          const horizontalOverlap = (dartRight > toothLeft) && (dartLeft < toothRight);
          const verticalOverlap = (dartTop > toothBottom) && (dartBottom < toothTop);

          if (horizontalOverlap && verticalOverlap) {
            return tooth;
          }
        }
        return null;
      }

      // Process hit tooth
      function processHit(tooth) {
        if (!gameActive) return;

        const val = parseInt(tooth.dataset.value);
        if (val === currentAnswer) {
          score += 10;
          updateScore();
          feedbackEl.textContent = 'Correct! 🎉';

          tooth.classList.add('pop-correct');

          // Remove tooth after animation
          setTimeout(() => {
            tooth.remove();
            setupQuestion();
          }, 1000);
        } else {
          feedbackEl.textContent = `Wrong! That was ${val}. Try again!`;
          tooth.classList.add('pop-wrong');
          setTimeout(() => {
            tooth.classList.remove('pop-wrong');
            feedbackEl.textContent = 'Shoot the correct tooth!';
          }, 800);
        }
      }

      // Game loop to animate darts and check collisions
      function gameLoop() {
        if (!gameActive) return;

        const gameRect = game.getBoundingClientRect();

        for (let i = darts.length - 1; i >= 0; i--) {
          const dartObj = darts[i];
          if (!dartObj.active) continue;

          dartObj.y += dartObj.speed;

          // Move dart element visually (bottom up)
          dartObj.el.style.bottom = `${dartObj.y}px`;

          // Remove dart if offscreen
          if (dartObj.y > gameRect.height) {
            dartObj.el.remove();
            darts.splice(i, 1);
            continue;
          }

          // Check collision with teeth
          const hitTooth = detectCollision(dartObj);
          if (hitTooth) {
            dartObj.active = false;
            dartObj.el.remove();
            darts.splice(i, 1);
            processHit(hitTooth);
          }
        }

        requestAnimationFrame(gameLoop);
      }

      // Keyboard controls
      window.addEventListener('keydown', e => {
        if (!gameActive) return;

        if (e.key === 'ArrowLeft' || e.key.toLowerCase() === 'a') {
          e.preventDefault();
          moveShooterLeft();
        }
        else if (e.key === 'ArrowRight' || e.key.toLowerCase() === 'd') {
          e.preventDefault();
          moveShooterRight();
        }
        else if (e.key === ' ' || e.key === 'Enter') {
          e.preventDefault();
          shootDart();
        }
      });

      // Touch controls: tap left/right of screen to move shooter
      game.addEventListener('click', e => {
        if (!gameActive) return;

        const rect = game.getBoundingClientRect();
        const xPercent = ((e.clientX - rect.left) / rect.width) * 100;

        if (xPercent < shooterPos) {
          moveShooterLeft();
        } else {
          moveShooterRight();
        }
      });

      // Start game
      startBtn.addEventListener('click', () => {
        if (gameActive) return;

        score = 0;
        updateScore();
        feedbackEl.textContent = '';
        startBtn.disabled = true;
        startBtn.textContent = 'Game Running...';
        gameActive = true;
        shooterPos = 50;
        updateShooter();

        setupQuestion();
        startTimer();
        requestAnimationFrame(gameLoop);
      });

      // Initial setup
      updateShooter();

    })();
  </script>
</body>
</html>
